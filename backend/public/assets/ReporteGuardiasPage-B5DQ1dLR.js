import{r as b,j as e}from"./index-CrpPZsvu.js";import{C as h,B as f,a as y}from"./CancelButtonModal-BoD_aq40.js";import{u as g,B as j}from"./BaseTable-CsPZTHSS.js";import{u as v}from"./useQuery-JHOG_8HK.js";import{o as q,c as E,d as F}from"./firebaseConfig-enmzD80w.js";import{n as u}from"./useReportes-fRvlvEg1.js";import{A as m}from"./AlertaCard-CTxQbRQP.js";import{I as N}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const p=()=>new Promise(s=>{const a=q(E(F,"reportesGuardia"),t=>{const n=t.docs.map(r=>{const l=r.data().equipo,d=Object.entries(l).filter(([,i])=>i===!0).map(([i])=>i);return{id:r.id,...r.data(),fecha:u(r.data().fecha).format("YYYY-MM-DD"),fecha_format:u(r.data().fecha).format("DD/MM/YYYY"),guardia:`${r.data().nombreEmpleado} (${r.data().empleadoId})`,equipo:d.join(", ")}});s({data:n,unsubscribe:a})})}),w=()=>{var a;const s=v({queryKey:["reportes-guardias"],queryFn:async()=>{const{data:t,unsubscribe:n}=await p();return{data:t,unsubscribe:n}},refetchOnWindowFocus:!1,staleTime:1/0,enabled:!1});return b.useEffect(()=>{let t=null;return p().then(({unsubscribe:n})=>{s.refetch(),t=n}),()=>{t&&t()}},[]),{data:((a=s.data)==null?void 0:a.data)??[],isLoading:s.isLoading,isError:s.isError,error:s.error}},I={generalFields:[{required:!1,type:"text",label:"Orden de servicio",name:"idServicio"},{required:!1,type:"text",label:"Guardia",name:"nombreEmpleado"},{required:!1,type:"text",label:"No. empleado",name:"empleadoId"},{required:!1,type:"text",label:"Supervisor",name:"supervisor"},{required:!1,type:"text",label:"Elemento que recibe el uniforme",name:"elementoRecibe"},{required:!1,type:"text",label:"Elemento que entrega el uniforme",name:"elementoEntrega"},{required:!1,type:"date",label:"Fecha",name:"fecha"},{required:!1,type:"textarea",label:"Equipo",name:"equipo"},{required:!1,type:"text",label:"Turno",name:"turno"},{required:!1,type:"text",label:"Punto de vigilancia",name:"puntoVigilancia"}]},Y=()=>{var n,r,l,d;const{view:s,formData:a,handleInputChange:t}=g();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[I.generalFields.map(({type:i,label:o,name:c,required:x})=>e.jsx(N,{type:i,label:o,name:c,required:x,value:a[c]||"",onChange:t,disabled:s,classInput:"md:col-span-3"},c)),((n=a==null?void 0:a.consignas)==null?void 0:n.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Consignas"})}),(r=a==null?void 0:a.consignas)==null?void 0:r.map((i,o)=>e.jsx("div",{className:"md:col-span-3 border border-gray-300 p-4 rounded-lg shadow-sm bg-white",children:e.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-800",children:e.jsxs("li",{children:[e.jsxs("strong",{children:["Consigna ",o+1,":"]})," ",i]})})},`consignas-${o}`))]}),((l=a==null?void 0:a.observaciones)==null?void 0:l.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Observaciones"})}),(d=a==null?void 0:a.observaciones)==null?void 0:d.map((i,o)=>e.jsx("div",{className:"md:col-span-3 border border-gray-300 p-4 rounded-lg shadow-sm bg-white",children:e.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-800",children:e.jsxs("li",{children:[e.jsxs("strong",{children:["Observaci√≥n ",o+1,":"]})," ",i.descripcion]})})},`observaciones-${o}`))]})]}),e.jsx("hr",{className:"text-gray-300"}),s?e.jsx(h,{}):e.jsx(f,{})]})},C=[{key:"servicioId",name:"Orden"},{key:"guardia",name:"Nombre"},{key:"supervisor",name:"Supervisor"},{key:"puntoVigilancia",name:"Punto de vigilancia"},{key:"turno",name:"Turno"},{key:"fecha_format",name:"Fecha"}];function L(){const{modalType:s}=g(),{data:a,isLoading:t,isError:n,error:r}=w();return n?e.jsx("div",{children:r.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(j,{columns:C,data:a||[],title:"Reporte de guardias",loading:t}),s==="view"&&e.jsx(y,{Inputs:e.jsx(Y,{})})]})}export{L as default};
