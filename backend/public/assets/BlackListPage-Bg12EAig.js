import{a as j,u as N,t as g,r as C,j as e,f as _}from"./index-CrpPZsvu.js";import{C as D,B as k,a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as q,u as F,T as S,B as M}from"./BaseTable-CsPZTHSS.js";import{u as B}from"./useQuery-JHOG_8HK.js";import{u as w,S as x}from"./sweetalert2.esm.all-C9US9OKy.js";import{I as c}from"./InputField-CAlv3cmG.js";import{A as m}from"./AlertaCard-CTxQbRQP.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const I=async t=>{try{return(await j.post("blacklist",t)).data}catch(s){throw console.error("Error al agregar registro:",s),new Error(s.response.data.message)}},P=async()=>{try{const t=await j.get("blacklist"),{data:s}=t;return s.map(l=>({...l,nombre:`${l.guardia.nombre} ${l.guardia.apellido_p} ${l.guardia.apellido_m}`,guardia:{...l.guardia,sucursal_empresa_id:{label:l.guardia.sucursal_empresa.nombre_sucursal,value:l.guardia.sucursal_empresa.id}}}))}catch(t){throw console.error("Error al obetener el registro",t),new Error(t.response.data.message)}},A=async t=>{try{const{id:s}=t;return(await j.put(`blacklist/${s}`,t)).data}catch(s){throw console.error("Error al actualizar registro:",s),new Error(s.response.data.message)}},L=async t=>{try{return(await j.delete(`blacklist/${t}`)).data}catch(s){throw console.error("Error al eliminar registro:",s),new Error(s.response.data.message)}},O=()=>{const t=q(r=>r.modalType),s=q(r=>r.formData),l=q(r=>r.closeModal),i=N(),{isLoading:d,isError:p,data:f,error:y}=B({queryKey:["blacklist"],queryFn:P}),h=w({mutationFn:I,onSuccess:()=>{i.invalidateQueries({queryKey:["blacklist"]}),g.success("Registro agregado"),x.close(),l()},onError:r=>{x.close(),g.error(r.message)}}),v=w({mutationFn:A,onSuccess:()=>{i.invalidateQueries({queryKey:["blacklist"]}),g.success("Registro actualizado"),l(),x.close()},onError:r=>{g.error(r.message),x.close()}}),o=w({mutationFn:L,onSuccess:()=>{i.invalidateQueries({queryKey:["blacklist"]}),g.success("Registro eliminado")},onError:r=>{g.error(r.message)}});return{data:f,error:y,isError:p,isLoading:d,handleSubmit:r=>{if(r.preventDefault(),x.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{x.showLoading()}}),t==="add"){const u={...s,guardia_id:s.guardia_id.value};h.mutate(u)}else t==="edit"&&v.mutate(s)},handleDelete:r=>{o.mutate(r),l()}}},b={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"textarea",label:"Motivo de la baja *",name:"motivo_baja"}],personalFields:[{required:!0,type:"text",label:"Nombre *",name:"nombre"},{required:!0,type:"text",label:"Apellido paterno *",name:"apellido_p"},{required:!0,type:"text",label:"Apellido materno *",name:"apellido_m"},{required:!0,type:"number",label:"Edad *",name:"edad"},{required:!0,type:"number",label:"Teléfono *",name:"telefono"},{required:!0,type:"email",label:"Correo *",name:"correo"},{required:!0,type:"text",label:"Enfermedades *",name:"enfermedades"},{required:!0,type:"text",label:"Alergias *",name:"alergias"}],direccionFields:[{required:!0,type:"text",label:"Calle *",name:"calle"},{required:!0,type:"text",label:"Número *",name:"numero"},{required:!0,type:"text",label:"Colonia *",name:"colonia"},{required:!0,type:"number",label:"Código postal *",name:"cp"},{required:!0,type:"text",label:"Municipio *",name:"municipio"},{required:!0,type:"text",label:"Estado *",name:"estado"},{required:!0,type:"text",label:"País *",name:"pais"}],otrosFields:[{required:!0,type:"number",label:"Teléfono de emergencia *",name:"telefono_emergencia"},{required:!0,type:"text",label:"Contacto de emergencia *",name:"contacto_emergencia"},{required:!0,type:"async",label:"Sucursal a la que pertenece *",name:"sucursal_empresa_id"},{required:!0,type:"text",label:"Número de empleado *",name:"numero_empleado"}],documentFields:[{required:!0,type:"file",label:"CURP (PDF) *",name:"curp",accept:"application/pdf"},{required:!0,type:"file",label:"INE (PDF) *",name:"ine",accept:"application/pdf"},{required:!0,type:"file",label:"Acta de nacimiento (PDF) *",name:"acta_nacimiento",accept:"application/pdf"},{required:!0,type:"file",label:"Comprobante de domicilio (PDF) *",name:"comprobante_domicilio",accept:"application/pdf"},{required:!0,type:"file",label:"Constancia de situación fiscal (PDF) *",name:"constancia_situacion_fiscal",accept:"application/pdf"},{required:!1,type:"file",label:"Comprobante de estudios (PDF)",name:"comprobante_estudios",accept:"application/pdf"},{required:!1,type:"file",label:"Carta de recomendación (PDF)",name:"carta_recomendacion",accept:"application/pdf"},{required:!1,type:"file",label:"Carta de antecedentes no penales (PDF)",name:"antecedentes_no_penales",accept:"application/pdf"},{required:!1,type:"file",label:"Otro archivo (PDF)",name:"otro_archivo",accept:"application/pdf"}],antodopingFields:[{required:!1,type:"file",label:"Antidoping (PDF)",name:"antidoping",accept:"application/pdf"},{required:!1,type:"date",label:"Fecha del último antidoping",name:"fecha_antidoping"}],prestacionesFields:[{required:!0,step:"0.01",type:"number",label:"Sueldo base x semana *",name:"sueldo_base"},{required:!0,step:"0.01",type:"number",label:"Días laborales x semana *",name:"dias_laborales"},{required:!0,step:"0.01",type:"number",label:"Aguinaldo *",name:"aguinaldo"},{required:!0,step:"0.01",type:"number",label:"IMSS *",name:"imss"},{required:!0,step:"0.01",type:"number",label:"INFONAVIT *",name:"infonavit"},{required:!0,step:"0.01",type:"number",label:"FONACOT *",name:"fonacot"},{required:!0,step:"0.01",type:"number",label:"Retención de impuestos *",name:"retencion_isr"}]},T=()=>{const{view:t,add:s,document:l,formData:i,handleInputChange:d,handleFileChange:p,loadOptionsSucursalesEmpresa:f,loadOptionsTodosGuardias:y}=F(),h=C.useRef(null),v=()=>{var o;(o=h.current)==null||o.click()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[s&&b.generalFields.map(({type:o,label:n,name:a,required:r})=>e.jsx(c,{type:o,label:n,name:a,required:r,value:i[a]||"",onChange:d,loadOptions:y,disabled:!1,classInput:"md:col-span-2"},a)),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Motivo de porque está en lista negra"})}),e.jsx(c,{type:"textarea",label:"Motivo",name:"motivo_baja",required:!0,value:i.motivo_baja||"",onChange:d,disabled:t,classInput:"md:col-span-2"})]}),!s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Datos del guardia"})}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2 w-96 mx-auto",children:e.jsxs("div",{onClick:v,className:"cursor-pointer border-2 border-dashed border-gray-300 rounded-lg p-4 transition-all hover:border-blue-500 flex flex-col items-center justify-center",children:[e.jsx("input",{type:"file",ref:h,onChange:p,accept:"image/*",className:"hidden",name:"foto",required:!l,disabled:t}),e.jsx("div",{className:"w-full",children:e.jsx("img",{src:i.guardia.foto_url||_,alt:"Foto de perfil",className:"max-h-60 mx-auto rounded-md object-contain"})})]})}),b.personalFields.map(({type:o,label:n,name:a,required:r})=>e.jsx(c,{type:o,label:n,name:a,required:r,value:i.guardia[a]||"",onChange:d,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Dirección"})}),b.direccionFields.map(({type:o,label:n,name:a,accept:r,required:u})=>e.jsx(c,{type:o,accept:r,label:n,required:u,name:a,value:i.guardia[a]||"",onChange:d,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Documentos"})}),b.documentFields.map(({type:o,label:n,name:a,accept:r,required:u})=>e.jsx(c,{type:o,accept:r,label:n,required:l?!l:u,name:a,value:i.guardia[a]||"",onChange:p,document:i.guardia[`${a}_url`]||null,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Antidoping"})}),b.antodopingFields.map(({type:o,label:n,name:a,accept:r,required:u})=>e.jsx(c,{type:o,accept:r,label:n,required:l?!l:u,name:a,value:i.guardia[a]||"",onChange:o==="file"?p:d,document:i[`${a}_url`]||null,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Otros datos"})}),b.otrosFields.map(({type:o,label:n,name:a,required:r})=>e.jsx(c,{type:o,label:n,required:r,name:a,value:i.guardia[a]||"",onChange:d,loadOptions:f,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Prestaciones y sueldo"})}),b.prestacionesFields.map(({type:o,label:n,name:a,required:r,step:u})=>e.jsx(c,{type:o,label:n,required:r,name:a,step:u,value:i.guardia[a]||"",onChange:d,disabled:!0},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Información de rango"})}),e.jsx(c,{type:"select",label:"Nivel del guardia *",required:!0,name:"rango",value:i.guardia.rango||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Guardia",value:"Guardia"},{label:"Supervisor",value:"Supervisor"},{label:"Jefe de turno",value:"Jefe de turno"}],onChange:d,disabled:!0,classInput:"md:col-span-2"}),l&&e.jsx(c,{type:"select",label:"Estatus del guardia *",required:!0,name:"estatus",value:i.guardia.estatus||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Disponible",value:"Disponible"},{label:"Descansado",value:"Descansado"},{label:"Dado de baja",value:"Dado de baja"},{label:"Asignado",value:"Asignado"}],onChange:d,disabled:!0,classInput:"md:col-span-2"})]})]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(D,{}):e.jsx(k,{})]})},R=({handleDelete:t})=>{const{closeModal:s,formData:l}=F();return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",ocupacion:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-40 transition-opacity","aria-hidden":"true",onClick:s}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(S,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:["Quitar de la lista negra a ",l.nombre]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"¿Estás seguro de realizar esta acción?"})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:()=>t(l.id),className:"cursor-pointer w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Quitar de lista negra"}),e.jsx("button",{type:"button",onClick:s,className:"cursor-pointer mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar"})]})]})]})})},Q=[{key:"nombre",name:"Guardia"},{key:"motivo_baja",name:"Motivo de baja"}];function Y(){const{modalType:t,currentItem:s}=F(),{data:l,isLoading:i,isError:d,error:p,handleSubmit:f,handleDelete:y}=O();return d?e.jsx("div",{children:p.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(M,{columns:Q,data:l||[],title:"Lista negra de guardias",loading:i}),(t==="add"||t==="edit"||t==="view")&&e.jsx(E,{handleSubmit:f,Inputs:e.jsx(T,{})}),t==="whitelist"&&s&&e.jsx(R,{handleDelete:y})]})}export{Y as default};
