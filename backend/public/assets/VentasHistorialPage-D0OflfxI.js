import{j as a}from"./index-CB-Ik059.js";import{I as i,C as g,B as f,a as y}from"./CancelButtonModal-DFIIInB4.js";import{d as v,k as p,B as z}from"./BaseTable-lMESkOGa.js";import{A as _}from"./AlertaCard-azZSUJ8e.js";import{a as x,u as q}from"./configAxios-zIrC1_jU.js";import"./square-pen-D170uhu7.js";const b={generalFields:[{required:!0,type:"async",label:"Selecciona la cotizacion",name:"cotizacion_id"},{required:!0,type:"select",label:"Tipo de pago",name:"tipo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"select",label:"Método de pago",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"text",label:"Número de factura",name:"numero_factura"},{required:!0,type:"date",label:"Fecha de cotización aceptada",name:"fecha_emision"},{required:!0,type:"number",label:"Días de crédito",name:"credito_dias"},{required:!0,type:"date",label:"Fecha de vencimiento de crédito",name:"fecha_vencimiento"},{required:!0,type:"number",label:"Monto de la nota de credito",name:"nota_credito"},{required:!0,type:"number",label:"Total *",name:"total"}],actualFields:[{required:!0,type:"select",label:"Tipo de pago",name:"tipo_pago_actualizado",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"select",label:"Método de pago",name:"metodo_pago_actualizado",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"text",label:"Número de factura",name:"numero_factura_actualizado"},{required:!0,type:"date",label:"Fecha de cotización aceptada",name:"fecha_emision_actualizado"},{required:!0,type:"number",label:"Días de crédito",name:"credito_dias_actualizado"},{required:!0,type:"date",label:"Fecha de vencimiento de crédito",name:"fecha_vencimiento_actualizado"},{required:!0,type:"number",label:"Monto de la nota de credito",name:"nota_credito_actualizado"},{required:!0,type:"number",label:"Total *",name:"total_actualizado"}]},j=()=>{const{view:n,formData:t,handleInputChange:o,loadOptionsCotizaciones:e}=v();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[a.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:a.jsx(_,{text:"Registro originalmente guardado (antes de cualquier cambio)"})}),b.generalFields.map(({type:c,label:s,name:l,required:r,opcSelect:d})=>a.jsx(i,{type:c,label:s,name:l,required:r,value:t[l]||"",opcSelect:d,loadOptions:e,onChange:o,disabled:!0},l)),a.jsx(i,{type:"select",label:"Estatus de la venta *",name:"estatus",required:!0,value:t.estatus||"",opcSelect:[{label:"Pendiente",value:"Pendiente"},{label:"Pagada",value:"Pagada"}],onChange:o,disabled:!0}),t.estatus==="Cancelada"&&a.jsx(i,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada",required:!1,value:t.motivo_cancelada||"",onChange:o,disabled:!0,classInput:"md:col-span-2"}),a.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:a.jsx(_,{text:"Registro de venta actual (después de algún posible cambio)"})}),b.actualFields.map(({type:c,label:s,name:l,required:r,opcSelect:d})=>a.jsx(i,{type:c,label:s,name:l,required:r,value:t[l]||"",opcSelect:d,loadOptions:e,onChange:o,disabled:!0},l)),a.jsx(i,{type:"select",label:"Estatus de la venta *",name:"estatus_actualizado",required:!0,value:t.estatus_actualizado||"",opcSelect:[{label:"Pendiente",value:"Pendiente"},{label:"Pagada",value:"Pagada"}],onChange:o,disabled:!0}),t.estatus_actualizado==="Cancelada"&&a.jsx(i,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada_actualizado",required:!1,value:t.motivo_cancelada_actualizado||"",onChange:o,disabled:!0,classInput:"md:col-span-2"})]}),a.jsx("hr",{className:"text-gray-300"}),n?a.jsx(g,{}):a.jsx(f,{})]})},C=async()=>{try{const n=await x.get("ventas-historial"),{data:t}=n;return Array.isArray(t)?t.map(e=>{var r,d,u,m;const c=(r=e==null?void 0:e.cotizacion)!=null&&r.sucursal?(u=(d=e==null?void 0:e.cotizacion)==null?void 0:d.sucursal)==null?void 0:u.nombre_empresa:(m=e==null?void 0:e.cotizacion)==null?void 0:m.nombre_empresa,s=p(e.fecha_emision,"YYYY-MM-DD").format("DD/MM/YYYY"),l=p(e.fecha_emision,"YYYY-MM-DD").format("DD/MM/YYYY");return{...e,cotizacion_id:{label:c,value:e.cotizacion.id},cotizacion:e.cotizacion.id,sucursal:typeof c=="string"?c:"",total_format:`$${e.total}`,cotizacion_aceptada:s,fecha_emision_format:l,credito_dias:e.credito_dias,numero_factura_actualizado:e.venta.numero_factura,fecha_emision_actualizado:e.venta.fecha_emision,fecha_vencimiento_actualizado:e.venta.fecha_vencimiento,total_actualizado:e.venta.total,nota_credito_actualizado:e.venta.nota_credito,tipo_pago_actualizado:e.venta.tipo_pago,metodo_pago_actualizado:e.venta.metodo_pago,estatus_actualizado:e.venta.estatus,motivo_cancelada_actualizado:e.venta.motivo_cancelada,credito_dias_actualizado:e.venta.cotizacion.credito_dias}}):[]}catch(n){throw console.error("Error al obetener el registro",n),new Error(n.response.data.message)}},M=()=>{const{isLoading:n,isError:t,data:o,error:e}=q({queryKey:["ventas-historial"],queryFn:C});return{data:o,error:e,isError:t,isLoading:n}},Y=[{key:"venta_id",name:"ID venta"},{key:"cotizacion",name:"ID cotización"},{key:"numero_factura",name:"Número factura"},{key:"fecha_emision_format",name:"Fecha emisión"},{key:"total_format",name:"Total"},{key:"accion",name:"Acción"}];function P(){const{modalType:n}=v(),{data:t,isLoading:o,isError:e,error:c}=M();return e?a.jsx("div",{children:c.message}):a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(z,{columns:Y,data:t||[],title:"Historial de ventas",loading:o}),n==="view"&&a.jsx(y,{Inputs:a.jsx(j,{})})]})}export{P as default};
