import{a as p,u as E,t as d,j as t}from"./index-CrpPZsvu.js";import{C as w,B as M,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as g,u as x,B as v}from"./BaseTable-CsPZTHSS.js";import{M as D}from"./ModalDelete-CfgHdyab.js";import{u as F}from"./useQuery-JHOG_8HK.js";import{u as f,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as y}from"./useReportes-fRvlvEg1.js";import{I as T}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const q=async e=>{try{return(await p.post("tiempo-extra",e)).data}catch(r){throw console.error("Error al agregar registro:",r),new Error(r.response.data.message)}},S=async()=>{try{const e=await p.get("tiempo-extra"),{data:r}=e;return r.map(o=>{const s=`${o.guardia.nombre} ${o.guardia.apellido_p} ${o.guardia.apellido_m}`,i=y(o.fecha_inicio).format("DD/MM/YYYY"),l=y(o.fecha_fin).format("DD/MM/YYYY"),n=`$${o.monto_por_hora}`,m=`$${o.monto_total}`,c={label:s,value:o.guardia.id};return{nombre:s,guardia_id:c,fecha_inicio_format:i,fecha_fin_format:l,monto_hora_format:n,monto_total_format:m,...o}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},$=async e=>{try{const{id:r}=e;return(await p.put(`tiempo-extra/${r}`,e)).data}catch(r){throw console.error("Error al actualizar registro:",r),new Error(r.response.data.message)}},C=async e=>{try{return(await p.delete(`tiempo-extra/${e}`)).data}catch(r){throw console.error("Error al eliminar registro:",r),new Error(r.response.data.message)}},Y=()=>{const e=g(a=>a.modalType),r=g(a=>a.formData),o=g(a=>a.closeModal),s=E(),{isLoading:i,isError:l,data:n,error:m}=F({queryKey:["tiempo-extra"],queryFn:S}),c=f({mutationFn:q,onSuccess:()=>{s.invalidateQueries({queryKey:["tiempo-extra"]}),d.success("Registro agregado"),u.close(),o()},onError:a=>{u.close(),d.error(a.message)}}),_=f({mutationFn:$,onSuccess:()=>{s.invalidateQueries({queryKey:["tiempo-extra"]}),d.success("Registro actualizado"),o(),u.close()},onError:a=>{d.error(a.message),u.close()}}),b=f({mutationFn:C,onSuccess:()=>{s.invalidateQueries({queryKey:["tiempo-extra"]}),d.success("Registro eliminado")},onError:a=>{d.error(a.message)}});return{data:n,error:m,isError:l,isLoading:i,handleSubmit:a=>{a.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const h={...r,guardia_id:r.guardia_id.value};e==="add"?c.mutate(h):e==="edit"&&_.mutate(h)},handleDelete:a=>{b.mutate(a),o()}}},k={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"number",label:"Horas extras trabajadas *",name:"horas"},{required:!0,type:"number",step:"0.01",label:"Monto x hora *",name:"monto_por_hora"},{required:!0,type:"number",step:"0.01",label:"Monto total *",name:"monto_total"},{required:!0,type:"date",label:"Fecha de inicio del periodo *",name:"fecha_inicio"},{required:!0,type:"date",label:"Fecha de fin del periodo *",name:"fecha_fin"}]},B=()=>{const{view:e,formData:r,handleInputChange:o,loadOptionsTodosGuardias:s}=x();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:k.generalFields.map(({type:i,label:l,name:n,required:m,step:c})=>t.jsx(T,{type:i,label:l,name:n,required:m,value:r[n]||"",step:c,onChange:o,loadOptions:s,disabled:n==="monto_total"?!0:e,classInput:"md:col-span-1"},n))}),t.jsx("hr",{className:"text-gray-300"}),e?t.jsx(w,{}):t.jsx(M,{})]})},I=[{key:"nombre",name:"Guardia"},{key:"fecha_inicio_format",name:"Inicio del periodo"},{key:"fecha_fin_format",name:"Fin del periodo"},{key:"horas",name:"Horas extras trabajadas"},{key:"monto_hora_format",name:"Pagado x hora"},{key:"monto_total_format",name:"Pagado total"}];function J(){const{modalType:e,currentItem:r}=x(),{data:o,isLoading:s,isError:i,error:l,handleSubmit:n,handleDelete:m}=Y();return i?t.jsx("div",{children:l.message}):t.jsxs("div",{className:"md:p-4 bg-gray-100",children:[t.jsx(v,{columns:I,data:o||[],title:"Tiempo extra",loading:s}),(e==="add"||e==="edit"||e==="view")&&t.jsx(j,{handleSubmit:n,Inputs:t.jsx(B,{})}),e==="delete"&&r&&t.jsx(D,{handleDelete:m})]})}export{J as default};
