import{a as p,u as x,t as d,j as s}from"./index-CrpPZsvu.js";import{C as j,B as M,a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as f,u as w,B as _}from"./BaseTable-CsPZTHSS.js";import{M as q}from"./ModalDelete-CfgHdyab.js";import{u as D}from"./useQuery-JHOG_8HK.js";import{u as y,S as m}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as F}from"./useReportes-fRvlvEg1.js";import{I as v}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const S=async e=>{try{return(await p.post("abonos-prestamo",e)).data}catch(a){throw console.error("Error al agregar registro:",a),new Error(a.response.data.message)}},C=async()=>{try{const e=await p.get("abonos-prestamo"),{data:a}=e;return a.map(o=>{const t=`${o.prestamo.guardia.nombre} ${o.prestamo.guardia.apellido_p} ${o.prestamo.guardia.apellido_m}`,l=`$${o.monto}`,i={label:t,value:o.prestamo.guardia.id},c=F(o.fecha).format("DD/MM/YYYY"),n={label:`${t} (${o.prestamo.monto_total})`,value:o.prestamo.id},u=`${t} (${l})`;return{...o,nombre:t,guardia_id:i,monto_format:l,fecha_format:c,prestamo_id:n,prestamo:u}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},P=async e=>{try{const{id:a}=e;return(await p.put(`abonos-prestamo/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},$=async e=>{try{return(await p.delete(`abonos-prestamo/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},A=()=>{const e=f(r=>r.modalType),a=f(r=>r.formData),o=f(r=>r.closeModal),t=x(),{isLoading:l,isError:i,data:c,error:n}=D({queryKey:["abonos-prestamo"],queryFn:C}),u=y({mutationFn:S,onSuccess:()=>{t.invalidateQueries({queryKey:["abonos-prestamo"]}),d.success("Registro agregado"),m.close(),o()},onError:r=>{m.close(),d.error(r.message)}}),g=y({mutationFn:P,onSuccess:()=>{t.invalidateQueries({queryKey:["abonos-prestamo"]}),d.success("Registro actualizado"),o(),m.close()},onError:r=>{d.error(r.message),m.close()}}),b=y({mutationFn:$,onSuccess:()=>{t.invalidateQueries({queryKey:["abonos-prestamo"]}),d.success("Registro eliminado")},onError:r=>{d.error(r.message)}});return{data:c,error:n,isError:i,isLoading:l,handleSubmit:r=>{r.preventDefault(),m.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{m.showLoading()}});const h={...a,prestamo_id:a.prestamo_id.value};e==="add"?u.mutate(h):e==="edit"&&g.mutate(h)},handleDelete:r=>{b.mutate(r),o()}}},O={generalFields:[{required:!0,type:"async",label:"Selecciona el préstamo a cual abonar *",name:"prestamo_id"},{required:!0,type:"number",step:"0.01",label:"Monto del abono *",name:"monto"},{required:!0,type:"date",label:"Fecha del abono *",name:"fecha"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"},{label:"Descuento nómina",value:"Descuento nómina"},{label:"Otro",value:"Otro"}]}]},T=()=>{const{view:e,document:a,formData:o,handleInputChange:t,loadOptionsPrestamos:l}=w();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[O.generalFields.map(({type:i,label:c,name:n,required:u,step:g,opcSelect:b})=>s.jsx(v,{type:i,label:c,name:n,required:u,value:o[n]||"",step:g,opcSelect:b,onChange:t,loadOptions:l,disabled:["prestamo_id","monto","fecha"].includes(n)&&a?!0:e,classInput:"md:col-span-1"},n)),s.jsx(v,{type:"textarea",label:"Obervaciones",name:"observaciones",required:!1,value:o.observaciones||"",onChange:t,disabled:e,classInput:"md:col-span-2"})]}),s.jsx("hr",{className:"text-gray-300"}),e?s.jsx(j,{}):s.jsx(M,{})]})},B=[{key:"prestamo",name:"Préstamo"},{key:"monto_format",name:"Monto prestado"},{key:"fecha_format",name:"Fecha del pago"},{key:"metodo_pago",name:"Método del pago"}];function J(){const{modalType:e,currentItem:a}=w(),{data:o,isLoading:t,isError:l,error:i,handleSubmit:c,handleDelete:n}=A();return l?s.jsx("div",{children:i.message}):s.jsxs("div",{className:"md:p-4 bg-gray-100",children:[s.jsx(_,{columns:B,data:o||[],title:"Abonos de los préstamos",loading:t}),(e==="add"||e==="edit"||e==="view")&&s.jsx(E,{handleSubmit:c,Inputs:s.jsx(T,{})}),e==="delete"&&a&&s.jsx(q,{handleDelete:n})]})}export{J as default};
