import{c as O,r as N,u as R,t as o,j as e}from"./index-CrpPZsvu.js";import{C as T,B as K,a as Q}from"./CancelButtonModal-BoD_aq40.js";import{a as k,e as z,d as U,u as S,S as J,B as V}from"./BaseTable-CsPZTHSS.js";import{M as $}from"./ModalDelete-CfgHdyab.js";import{u as H}from"./useQuery-JHOG_8HK.js";import{u as F,S as j}from"./sweetalert2.esm.all-C9US9OKy.js";import{r as W,u as X,c as Y,a as Z,b as ee,g as ae}from"./useReportes-fRvlvEg1.js";import{I as m}from"./InputField-CAlv3cmG.js";import{A as g}from"./AlertaCard-CTxQbRQP.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],te=O("Upload",se),M=()=>{let i;const[p,f]=N.useState([]),[l,y]=N.useState([]),[d,t]=N.useState({}),n=k(a=>a.modalType),b=k(a=>a.formData),v=k(a=>a.closeModal),h=R(),{isLoading:w,isError:r,data:u,error:s}=H({queryKey:["guardias"],queryFn:ae}),c=F({mutationFn:Y,onSuccess:()=>{h.invalidateQueries({queryKey:["guardias"]}),o.success("Registro agregado"),v(),j.close()},onError:a=>{o.error(a.message),j.close()}}),x=F({mutationFn:X,onSuccess:()=>{h.invalidateQueries({queryKey:["guardias"]}),o.success("Registro actualizado"),v(),j.close()},onError:a=>{o.error(a.message),j.close()}}),_=F({mutationFn:W,onSuccess:()=>{h.invalidateQueries({queryKey:["guardias"]}),o.success("Registro eliminado")},onError:a=>{o.error(a.message)}}),E=F({mutationFn:ee,onSuccess:()=>{h.invalidateQueries({queryKey:["guardias"]}),o.dismiss(i),o.warning("Guardia en lista negra"),v()},onError:a=>{o.dismiss(i),o.error(a.message)}}),I=F({mutationFn:Z,onSuccess:a=>{h.invalidateQueries({queryKey:["guardias"]}),o.dismiss(i),o.success(a.message)},onError:a=>{o.dismiss(i),o.error(a.message)}}),B=a=>{i=o.loading("Verificando si el guardia está en lista negra..."),I.mutate(a)},P=a=>{a.preventDefault(),j.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{j.showLoading()}});const C={...b,sucursal_empresa_id:b.sucursal_empresa_id.value};n==="add"?c.mutate(C):n==="edit"&&x.mutate(C)},A=a=>{_.mutate(a),v()},G=a=>{i=o.loading("Mandando al guardia a la lista negra..."),E.mutate(a)};N.useEffect(()=>{f(z),t(U)},[]),N.useEffect(()=>{const a=b.estado;if(!a){y([]);return}const C=d[a];y(C?C.map(D=>({value:D,label:D})):[])},[b.estado,d]);const L=[{value:"",label:"Selecciona un estado"},...p.map(a=>({value:a.nombre,label:a.nombre}))];return{isLoading:w,isError:r,data:u,error:s,createMutation:c,updateMutation:x,deleteMutation:_,handleSubmit:P,handleDelete:A,handleBlackList:G,handleCheckBlackList:B,opcionesEstados:L,municipios:l}},q={personalFields:[{required:!0,type:"text",label:"Nombre *",name:"nombre"},{required:!0,type:"text",label:"Apellido paterno *",name:"apellido_p"},{required:!0,type:"text",label:"Apellido materno *",name:"apellido_m"},{required:!0,type:"number",label:"Edad *",name:"edad"},{required:!0,type:"number",label:"Teléfono *",name:"telefono"},{required:!0,type:"email",label:"Correo *",name:"correo"},{required:!0,type:"text",label:"Enfermedades *",name:"enfermedades"},{required:!0,type:"text",label:"Alergias *",name:"alergias"}],direccionFields:[{required:!0,type:"text",label:"Calle *",name:"calle"},{required:!0,type:"text",label:"Número *",name:"numero"},{required:!0,type:"text",label:"Colonia *",name:"colonia"},{required:!0,type:"number",label:"Código postal *",name:"cp"}],otrosFields:[{required:!0,type:"number",label:"Teléfono de emergencia *",name:"telefono_emergencia"},{required:!0,type:"text",label:"Contacto de emergencia *",name:"contacto_emergencia"},{required:!0,type:"async",label:"Sucursal a la que pertenece *",name:"sucursal_empresa_id"},{required:!0,type:"text",label:"Número de empleado *",name:"numero_empleado"}],documentFields:[{required:!0,type:"file",label:"CURP (PDF) *",name:"curp",accept:"application/pdf"},{required:!0,type:"file",label:"INE (PDF) *",name:"ine",accept:"application/pdf"},{required:!0,type:"file",label:"Acta de nacimiento (PDF) *",name:"acta_nacimiento",accept:"application/pdf"},{required:!0,type:"file",label:"Comprobante de domicilio (PDF) *",name:"comprobante_domicilio",accept:"application/pdf"},{required:!0,type:"file",label:"Constancia de situación fiscal (PDF) *",name:"constancia_situacion_fiscal",accept:"application/pdf"},{required:!1,type:"file",label:"Comprobante de estudios (PDF)",name:"comprobante_estudios",accept:"application/pdf"},{required:!1,type:"file",label:"Carta de recomendación (PDF)",name:"carta_recomendacion",accept:"application/pdf"},{required:!1,type:"file",label:"Carta de antecedentes no penales (PDF)",name:"antecedentes_no_penales",accept:"application/pdf"},{required:!1,type:"file",label:"Otro archivo (PDF)",name:"otro_archivo",accept:"application/pdf"}],antodopingFields:[{required:!1,type:"file",label:"Antidoping (PDF)",name:"antidoping",accept:"application/pdf"},{required:!1,type:"date",label:"Fecha del último antidoping",name:"fecha_antidoping"}],prestacionesFields:[{required:!0,step:"0.01",type:"number",label:"Sueldo base x semana *",name:"sueldo_base"},{required:!0,step:"0.01",type:"number",label:"Días laborales x semana *",name:"dias_laborales"},{required:!0,step:"0.01",type:"number",label:"Aguinaldo *",name:"aguinaldo"},{required:!0,step:"0.01",type:"number",label:"IMSS *",name:"imss"},{required:!0,step:"0.01",type:"number",label:"INFONAVIT *",name:"infonavit"},{required:!0,step:"0.01",type:"number",label:"FONACOT *",name:"fonacot"},{required:!0,step:"0.01",type:"number",label:"Retención de impuestos *",name:"retencion_isr"}]},le=()=>{const{opcionesEstados:i,municipios:p,handleCheckBlackList:f}=M(),{view:l,add:y,document:d,formData:t,handleInputChange:n,handleFileChange:b,loadOptionsSucursalesEmpresa:v}=S(),h=N.useRef(null),w=()=>{var r;(r=h.current)==null||r.click()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Foto de perfil"})}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2 w-96 mx-auto",children:e.jsxs("div",{onClick:w,className:"cursor-pointer border-2 border-dashed border-gray-300 rounded-lg p-4 transition-all hover:border-blue-500 flex flex-col items-center justify-center",children:[e.jsx("input",{type:"file",ref:h,onChange:b,accept:"image/*",className:"hidden",name:"foto",required:!d,disabled:l}),t.preview||d?e.jsx("div",{className:"w-full",children:e.jsx("img",{src:t.preview||t.foto_url,alt:"Foto de perfil",className:"max-h-60 mx-auto rounded-md object-contain"})}):e.jsxs("div",{className:"py-6 flex flex-col items-center",children:[e.jsx(te,{className:"h-20 w-10 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500 text-center",children:"Click para seleccionar foto"})]})]})}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Información personal"})}),q.personalFields.map(({type:r,label:u,name:s,required:c})=>e.jsx(m,{type:r,label:u,name:s,required:c,value:t[s]||"",onChange:n,disabled:l},s)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Dirección"})}),q.direccionFields.map(({type:r,label:u,name:s,accept:c,required:x})=>e.jsx(m,{type:r,accept:c,label:u,required:x,name:s,value:t[s]||"",onChange:n,disabled:l},s)),e.jsx(m,{label:"Estado *",name:"estado",type:"select",value:t.estado,onChange:r=>{n(r),n({target:{name:"municipio",value:""}})},required:!0,disabled:l,opcSelect:i}),e.jsx(m,{label:"Municipio *",name:"municipio",type:"select",value:t.municipio,onChange:n,required:!0,disabled:l||p.length===0,opcSelect:[{value:"",label:"Selecciona un municipio"},...p]}),e.jsx(m,{label:"País *",name:"pais",type:"text",onChange:n,required:!0,disabled:l,value:t.pais||""}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Documentos"})}),q.documentFields.map(({type:r,label:u,name:s,accept:c,required:x})=>e.jsx(m,{type:r,accept:c,label:u,required:d?!d:x,name:s,value:t[s]||"",onChange:b,document:t[`${s}_url`]||null,disabled:l},s)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Antidoping"})}),q.antodopingFields.map(({type:r,label:u,name:s,accept:c,required:x})=>e.jsx(m,{type:r,accept:c,label:u,required:d?!d:x,name:s,value:t[s]||"",onChange:r==="file"?b:n,document:t[`${s}_url`]||null,disabled:l},s)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Otros datos"})}),q.otrosFields.map(({type:r,label:u,name:s,required:c})=>e.jsx(m,{type:r,label:u,required:c,name:s,value:t[s]||"",onChange:n,loadOptions:v,disabled:l},s)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Prestaciones y sueldo"})}),q.prestacionesFields.map(({type:r,label:u,name:s,required:c,step:x})=>e.jsx(m,{type:r,label:u,required:c,name:s,step:x,value:t[s]||"",onChange:n,disabled:l},s)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(g,{text:"Información de rango"})}),e.jsx(m,{type:"select",label:"Nivel del guardia *",required:!0,name:"rango",value:t.rango||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Guardia",value:"Guardia"},{label:"Supervisor",value:"Supervisor"},{label:"Jefe de turno",value:"Jefe de turno"}],onChange:n,disabled:l,classInput:"md:col-span-2"}),d&&e.jsx(m,{type:"select",label:"Estatus del guardia *",required:!0,name:"estatus",value:t.estatus||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Disponible",value:"Disponible"},{label:"Descansado",value:"Descansado"},{label:"Dado de baja",value:"Dado de baja"},{label:"Asignado",value:"Asignado"}],onChange:n,disabled:l,classInput:"md:col-span-2"})]}),e.jsx("hr",{className:"text-gray-300"}),y&&e.jsxs("div",{className:"my-5",children:[e.jsx(g,{text:"Revisa si el guardia está en la lista negra antes de guardar los datos."}),e.jsx("button",{type:"button",onClick:()=>f(t),className:"w-full mt-5 rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-500 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:text-sm cursor-pointer transition-all",children:"Revisar datos"})]}),e.jsx("hr",{className:"text-gray-300"}),l?e.jsx(T,{}):e.jsx(K,{})]})},re=({handleBlackList:i})=>{const{closeModal:p,formData:f,handleInputChange:l}=S(),y=d=>{d.preventDefault(),i(f)};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",ocupacion:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-40 transition-opacity","aria-hidden":"true",onClick:p}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("form",{onSubmit:y,className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsxs("div",{className:"sm:flex sm:items-start sm:gap-3",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(J,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Mandar al guardia a la lista negra"}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"¿Estás seguro de realizar esta acción?"})})]})]}),e.jsx(m,{type:"textarea",label:"Mótivo de baja",name:"motivo_baja",required:!0,value:f.motivo_baja||"",onChange:l,disabled:!1})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",className:"cursor-pointer w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gray-600 text-base font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Guardar datos"}),e.jsx("button",{type:"button",onClick:p,className:"cursor-pointer mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cerrar ventana"})]})]})]})})},ie=[{key:"nombre_completo",name:"Nombre"},{key:"nombre_sucursal",name:"Sucursal dado de alta"},{key:"numero_empleado",name:"Número de empleado"},{key:"rango",name:"Rango"},{key:"estatus",name:"Estatus"}];function ye(){const{modalType:i,currentItem:p}=S(),{data:f,isLoading:l,isError:y,error:d,handleSubmit:t,handleDelete:n,handleBlackList:b}=M();return y?e.jsx("div",{children:d.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(V,{columns:ie,data:f||[],title:"Guardias",loading:l}),(i==="add"||i==="edit"||i==="view")&&e.jsx(Q,{handleSubmit:t,Inputs:e.jsx(le,{})}),i==="delete"&&p&&e.jsx($,{handleDelete:n}),i==="blacklist"&&p&&e.jsx(re,{handleBlackList:b})]})}export{ye as default};
