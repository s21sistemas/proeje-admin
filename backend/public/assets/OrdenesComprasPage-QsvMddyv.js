import{j as o,a as y,u as E,t as l}from"./index-CrpPZsvu.js";import{C as q,B as S,a as O}from"./CancelButtonModal-BoD_aq40.js";import{u as w,a as g,B as M}from"./BaseTable-CsPZTHSS.js";import{M as D}from"./ModalDelete-CfgHdyab.js";import{A as C}from"./AlertaCard-CTxQbRQP.js";import{I as _}from"./InputField-CAlv3cmG.js";import{u as F}from"./useQuery-JHOG_8HK.js";import{u as v,S as c}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as P}from"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const j={generalFields:[{required:!0,type:"async",label:"Selecciona al proveedor *",name:"proveedor_id"},{required:!0,type:"async",label:"Selecciona el banco *",name:"banco_id"},{required:!0,type:"async",label:"Selecciona el articulo *",name:"articulo_id"},{required:!0,type:"text",label:"Numero OC *",name:"numero_oc"},{required:!0,type:"number",step:"0.01",label:"Cantidad de artículos",name:"cantidad_articulo"},{required:!0,type:"number",step:"0.01",label:"Precio por artículo",name:"precio_articulo"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"number",step:"0.01",label:"Subtotal *",name:"subtotal"},{required:!0,type:"number",step:"0.01",label:"Porcentaje de impuestos (si no aplica introducir 0) *",name:"impuesto"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"total"}],opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Pendiente",label:"Pendiente"},{value:"Pagada",label:"Pagada"},{value:"Cancelada",label:"Cancelada"}]},T=()=>{const{view:a,formData:e,edit:s,handleInputChange:r,loadOptionsBancos:i,loadOptionsArticulos:d,loadOptionsProveedores:u}=w();return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[o.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:o.jsx(C,{text:"Información de la orden de compra"})}),j.generalFields.map(({type:m,label:p,name:n,required:b,step:f,opcSelect:h})=>o.jsx(_,{type:m,label:p,name:n,step:f,required:b,value:e[n]||"",opcSelect:h,loadOptions:n==="proveedor_id"?u:n==="banco_id"?i:d,onChange:r,disabled:["precio_articulo","total","subtotal"].includes(n)||e.estatus==="Pagada"||e.estatus==="Cancelada"?!0:a,classInput:"md:col-span-1"},n)),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:o.jsx(C,{text:"Estatus de la orden de pago"})}),o.jsx(_,{type:"select",label:"Estatus *",name:"estatus",required:!0,value:e.estatus||"",opcSelect:j.opcSelect,onChange:r,disabled:e.estatus==="Pagada"||e.estatus==="Cancelada"?!0:a,classInput:"md:col-span-2"})]})]}),o.jsx("hr",{className:"text-gray-300"}),a?o.jsx(q,{}):o.jsx(S,{})]})},B=async a=>{try{return(await y.post("ordenes-compra",a)).data}catch(e){throw console.error("Error al crear el registro",e),new Error(e.response.data.message)}},k=async()=>{try{const a=await y.get("ordenes-compra"),{data:e}=a;return Array.isArray(e)?e.map(r=>({...r,banco_id:{label:r.banco.nombre,value:r.banco.id},proveedor_id:{label:r.proveedor.nombre_empresa,value:r.proveedor.id},articulo_id:{label:r.articulo.nombre,value:r.articulo.id},banco:r.banco.nombre,proveedor:r.proveedor.nombre_empresa,articulo:r.articulo.nombre,total_format:`$${r.total}`,fecha:P(r.created_at).format("DD/MM/YYYY")})):[]}catch(a){throw console.error("Error al obetener el registro",a),new Error(a.response.data.message)}},I=async a=>{try{const{id:e}=a;return(await y.put(`ordenes-compra/${e}`,a)).data}catch(e){throw console.error("Error al actualizar registro:",e),new Error(e.response.data.message)}},A=async a=>{try{return(await y.delete(`ordenes-compra/${a}`)).data}catch(e){throw console.error("Error al eliminar registro:",e),new Error(e.response.data.message)}},N=()=>{const a=g(t=>t.modalType),e=g(t=>t.formData),s=g(t=>t.closeModal),r=E(),{isError:i,data:d,error:u,isLoading:m}=F({queryKey:["ordenes-compra"],queryFn:k}),p=v({mutationFn:B,onSuccess:()=>{r.invalidateQueries({queryKey:["ordenes-compra"]}),l.success("Registro agregado"),s(),c.close()},onError:t=>{l.error(t.message),c.close()}}),n=v({mutationFn:I,onSuccess:()=>{r.invalidateQueries({queryKey:["ordenes-compra"]}),l.success("Registro actualizado"),s(),c.close()},onError:t=>{l.error(t.message),c.close()}}),b=v({mutationFn:A,onSuccess:()=>{r.invalidateQueries({queryKey:["ordenes-compra"]}),l.success("Registro eliminado")},onError:t=>{l.error(t.message)}});return{isLoading:m,isError:i,data:d,error:u,createMutation:p,updateMutation:n,deleteMutation:b,handleSubmit:t=>{t.preventDefault(),c.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{c.showLoading()}});const x={...e,proveedor_id:e.proveedor_id.value,banco_id:e.banco_id.value,articulo_id:e.articulo_id.value};a==="add"?p.mutate(x):a==="edit"&&n.mutate(x)},handleDelete:t=>{b.mutate(t),s()}}},K=[{key:"banco",name:"Banco"},{key:"proveedor",name:"Proveedor"},{key:"numero_oc",name:"# OC"},{key:"articulo",name:"Artículo"},{key:"total_format",name:"Total"},{key:"fecha",name:"Fecha"},{key:"estatus",name:"Estatus"}];function W(){const{modalType:a,currentItem:e}=w(),{data:s,isLoading:r,isError:i,error:d,handleSubmit:u,handleDelete:m}=N();return i?o.jsx("div",{children:d.message}):o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(M,{columns:K,data:s||[],title:"Ordenes de compra",loading:r}),(a==="add"||a==="edit"||a==="view")&&o.jsx(O,{handleSubmit:u,Inputs:o.jsx(T,{})}),a==="delete"&&e&&o.jsx(D,{handleDelete:m})]})}export{W as default};
