import{a as c,u as v,t as o,j as t}from"./index-CrpPZsvu.js";import{a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as p,u as q,B as Q}from"./BaseTable-CsPZTHSS.js";import{M as R}from"./ModalDelete-CfgHdyab.js";import{u as S}from"./useQuery-JHOG_8HK.js";import{u as g,S as n}from"./sweetalert2.esm.all-C9US9OKy.js";import{F as M}from"./FormGenerarQRS-Cjsop6yK.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./InputField-CAlv3cmG.js";const x=async r=>{try{return(await c.post("generar-qr",r)).data}catch(e){throw console.error("Error al agregar registro:",e),new Error(e.response.data.message)}},G=async()=>{try{const r=await c.get("generar-qr"),{data:e}=r;return e.map(s=>({...s,orden:s.orden_servicio.codigo_orden_servicio,notas_format:s.notas?s.notas:"Sin notas"}))}catch(r){throw console.error("Error al obetener el registro",r),new Error(r.response.data.message)}},_=async r=>{try{const{id:e}=r;return(await c.put(`generar-qr/${e}`,r)).data}catch(e){throw console.error("Error al actualizar registro:",e),new Error(e.response.data.message)}},j=async r=>{try{return(await c.delete(`generar-qr/${r}`)).data}catch(e){throw console.error("Error al eliminar registro:",e),new Error(e.response.data.message)}},D=()=>{const r=p(a=>a.modalType),e=p(a=>a.formData),s=p(a=>a.closeModal),i=v(),{isLoading:d,isError:l,data:u,error:m}=S({queryKey:["generar-qrs"],queryFn:G}),y=g({mutationFn:x,onSuccess:()=>{i.invalidateQueries({queryKey:["generar-qrs"]}),o.success("Registro agregado"),n.close(),s()},onError:a=>{n.close(),o.error(a.message)}}),f=g({mutationFn:_,onSuccess:()=>{i.invalidateQueries({queryKey:["generar-qrs"]}),o.success("Registro actualizado"),s(),n.close()},onError:a=>{o.error(a.message),n.close()}}),h=g({mutationFn:j,onSuccess:()=>{i.invalidateQueries({queryKey:["generar-qrs"]}),o.success("Registro eliminado")},onError:a=>{o.error(a.message)}});return{data:u,error:m,isError:l,isLoading:d,handleSubmit:a=>{if(a.preventDefault(),n.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{n.showLoading()}}),r==="add"){const w={...e,orden_servicio_id:e.orden_servicio_id.value};y.mutate(w)}else r==="edit"&&f.mutate(e)},handleDelete:a=>{h.mutate(a),s()}}},F=[{key:"orden",name:"Orden de servicio"},{key:"cantidad",name:"Cantidad de QRs generados"},{key:"notas_format",name:"Notas"}];function $(){const{modalType:r,currentItem:e}=q(),{data:s,isLoading:i,isError:d,error:l,handleSubmit:u,handleDelete:m}=D();return d?t.jsx("div",{children:l.message}):t.jsxs("div",{className:"md:p-4 bg-gray-100",children:[t.jsx(Q,{columns:F,data:s||[],title:"Generar c√≥digos QR",loading:i}),(r==="add"||r==="edit"||r==="view")&&t.jsx(E,{handleSubmit:u,Inputs:t.jsx(M,{})}),r==="delete"&&e&&t.jsx(R,{handleDelete:m})]})}export{$ as default};
