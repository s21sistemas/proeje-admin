import{r as f,j as e}from"./index-CrpPZsvu.js";import{C as x,B as g,a as b}from"./CancelButtonModal-BoD_aq40.js";import{u as p,B as h}from"./BaseTable-CsPZTHSS.js";import{u as y}from"./useQuery-JHOG_8HK.js";import{o as j,c as v,d as Y}from"./firebaseConfig-enmzD80w.js";import{n as d}from"./useReportes-fRvlvEg1.js";import{A as m}from"./AlertaCard-CTxQbRQP.js";import{I as q}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const u=()=>new Promise(r=>{const a=j(v(Y,"bitacoras"),s=>{const i=s.docs.map(t=>{const o=new Date(t.data().horaInicioRecorrido.seconds*1e3),l=new Date(t.data().horaFinRecorrido.seconds*1e3);return{id:t.id,...t.data(),guardia:`${t.data().nombre} (${t.data().numeroEmpleado})`,inicioRecorrido:d(o).format("YYYY-MM-DD HH:mm"),finRecorrido:d(l).format("YYYY-MM-DD HH:mm"),inicio_format:d(o).format("DD/MM/YYYY hh:mm A"),fin_format:d(l).format("DD/MM/YYYY hh:mm A")}});r({data:i,unsubscribe:a})})}),F=()=>{var a;const r=y({queryKey:["bitacoras"],queryFn:async()=>{const{data:s,unsubscribe:i}=await u();return{data:s,unsubscribe:i}},refetchOnWindowFocus:!1,staleTime:1/0,enabled:!1});return f.useEffect(()=>{let s=null;return u().then(({unsubscribe:i})=>{r.refetch(),s=i}),()=>{s&&s()}},[]),{data:((a=r.data)==null?void 0:a.data)??[],isLoading:r.isLoading,isError:r.isError,error:r.error}},B={generalFields:[{required:!1,type:"text",label:"Orden de servicio",name:"idServicio"},{required:!1,type:"text",label:"Guardia",name:"nombre"},{required:!1,type:"text",label:"No. empleado",name:"numeroEmpleado"},{required:!1,type:"datetime-local",label:"Fecha y hora de check",name:"inicioRecorrido"},{required:!1,type:"datetime-local",label:"Fecha y hora de check",name:"finRecorrido"},{required:!1,type:"text",label:"Kilometraje",name:"kilometraje"},{required:!1,type:"text",label:"Litros de carga",name:"litrosCarga"},{required:!1,type:"text",label:"Patrulla",name:"patrulla"},{required:!1,type:"text",label:"Servicio",name:"servicio"},{required:!1,type:"text",label:"Zona",name:"zona"}]},M=()=>{var i,t;const{view:r,formData:a,handleInputChange:s}=p();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Datos de la bitácora"})}),B.generalFields.map(({type:o,label:l,name:n,required:c})=>e.jsx(q,{type:o,label:l,name:n,required:c,value:a[n]||"",onChange:s,disabled:r,classInput:"md:col-span-2"},n)),((i=a==null?void 0:a.guardias)==null?void 0:i.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(m,{text:"Información de los guardias"})}),(t=a==null?void 0:a.guardias)==null?void 0:t.map((o,l)=>e.jsxs("div",{className:"md:col-span-3 border border-gray-300 p-4 rounded-lg shadow-sm bg-white",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:["Guardia ",l+1,": ",o.nombre," (",o.numeroEmpleado,")"]}),e.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-800",children:Object.entries(o.checkItems||{}).filter(([,n])=>n).map(([n])=>e.jsx("li",{children:n.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase())},n))})]},`guardia-${l}`))]})]}),e.jsx("hr",{className:"text-gray-300"}),r?e.jsx(x,{}):e.jsx(g,{})]})},I=[{key:"guardia",name:"Supervisor"},{key:"inicio_format",name:"Inicio recorrdio"},{key:"fin_format",name:"Fin recorrido"},{key:"patrulla",name:"Patrulla"},{key:"servicio",name:"Servicio"},{key:"zona",name:"Zona"}];function L(){const{modalType:r}=p(),{data:a,isLoading:s,isError:i,error:t}=F();return i?e.jsx("div",{children:t.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(h,{columns:I,data:a||[],title:"Bitácoras de guardias",loading:s}),r==="view"&&e.jsx(b,{Inputs:e.jsx(M,{})})]})}export{L as default};
