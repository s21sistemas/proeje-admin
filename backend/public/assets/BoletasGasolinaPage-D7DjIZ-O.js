import{a as m,u as x,t as i,j as r}from"./index-CrpPZsvu.js";import{C as w,B as M,a as B}from"./CancelButtonModal-BoD_aq40.js";import{a as h,u as _,B as E}from"./BaseTable-CsPZTHSS.js";import{M as q}from"./ModalDelete-CfgHdyab.js";import{u as C}from"./useQuery-JHOG_8HK.js";import{u as y,S as c}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as D,t as v}from"./useReportes-fRvlvEg1.js";import{I as b}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const F=async e=>{try{return(await m.post("boletas-gasolina",e)).data}catch(o){throw console.error("Error al agregar registro:",o),new Error(o.response.data.message)}},S=async()=>{try{const e=await m.get("boletas-gasolina"),{data:o}=e;return o.map(a=>({...a,vehiculo_id:{label:`${a.vehiculo.tipo_vehiculo} (${a.vehiculo.placas})`,value:a.vehiculo.id},vehiculo_tipo:`${a.vehiculo.tipo_vehiculo} (${a.vehiculo.placas})`,costo_litro_format:`${v(a.costo_litro)}`,costo_total_format:`${v(a.costo_total)}`,fecha:D(a.created_at).format("DD/MM/YYYY")}))}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},k=async e=>{try{const{id:o}=e;return(await m.put(`boletas-gasolina/${o}`,e)).data}catch(o){throw console.error("Error al actualizar registro:",o),new Error(o.response.data.message)}},G=async e=>{try{return(await m.delete(`boletas-gasolina/${e}`)).data}catch(o){throw console.error("Error al eliminar registro:",o),new Error(o.response.data.message)}},$=()=>{const e=h(s=>s.modalType),o=h(s=>s.formData),a=h(s=>s.closeModal),l=x(),{isLoading:n,isError:u,data:d,error:t}=C({queryKey:["boletas-gasolina"],queryFn:S}),p=y({mutationFn:F,onSuccess:()=>{l.invalidateQueries({queryKey:["boletas-gasolina"]}),i.success("Registro agregado"),c.close(),a()},onError:s=>{c.close(),i.error(s.message)}}),g=y({mutationFn:k,onSuccess:()=>{l.invalidateQueries({queryKey:["boletas-gasolina"]}),i.success("Registro actualizado"),a(),c.close()},onError:s=>{i.error(s.message),c.close()}}),j=y({mutationFn:G,onSuccess:()=>{l.invalidateQueries({queryKey:["boletas-gasolina"]}),i.success("Registro eliminado")},onError:s=>{i.error(s.message)}});return{data:d,error:t,isError:u,isLoading:n,handleSubmit:s=>{s.preventDefault(),c.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{c.showLoading()}});const f={...o,vehiculo_id:o.vehiculo_id.value};e==="add"?p.mutate(f):e==="edit"&&g.mutate(f)},handleDelete:s=>{j.mutate(s),a()}}},I={generalFields:[{required:!0,type:"async",label:"Selecciona el vehículo *",name:"vehiculo_id"},{required:!0,type:"number",step:"0.01",label:"Kilometraje *",name:"kilometraje"},{required:!0,type:"number",step:"0.01",label:"Litros de gasolina *",name:"litros"},{required:!0,type:"number",step:"0.01",label:"Costo por litro *",name:"costo_litro"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"costo_total"}]},K=()=>{const{view:e,edit:o,formData:a,handleInputChange:l,loadOptionsVehiculos:n}=_();return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[I.generalFields.map(({type:u,label:d,name:t,required:p,step:g})=>r.jsx(b,{type:u,label:d,name:t,required:p,step:g,value:a[t]||"",onChange:l,loadOptions:n,disabled:t==="costo_total"||o&&t==="vehiculo_id"?!0:e,classInput:"md:col-span-2"},t)),r.jsx(b,{type:"textarea",label:"Observaciones",name:"observaciones",required:!1,value:a.observaciones||"",onChange:l,loadOptions:n,disabled:e,classInput:"md:col-span-2"})]}),r.jsx("hr",{className:"text-gray-300"}),e?r.jsx(w,{}):r.jsx(M,{})]})},O=[{key:"vehiculo_tipo",name:"Vehículo"},{key:"kilometraje",name:"Kilometraje"},{key:"litros",name:"Litros gasolina"},{key:"costo_litro_format",name:"Costo x litro"},{key:"costo_total_format",name:"Total"},{key:"fecha",name:"Fecha"}];function H(){const{modalType:e,currentItem:o}=_(),{data:a,isLoading:l,isError:n,error:u,handleSubmit:d,handleDelete:t}=$();return n?r.jsx("div",{children:u.message}):r.jsxs("div",{className:"md:p-4 bg-gray-100",children:[r.jsx(E,{columns:O,data:a||[],title:"Boletas de gasolina",loading:l}),(e==="add"||e==="edit"||e==="view")&&r.jsx(B,{handleSubmit:d,Inputs:r.jsx(K,{})}),e==="delete"&&o&&r.jsx(q,{handleDelete:t})]})}export{H as default};
