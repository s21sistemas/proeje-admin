import{a as g,u as D,t as u,j as r}from"./index-CrpPZsvu.js";import{C as w,B as x,a as M}from"./CancelButtonModal-BoD_aq40.js";import{a as f,u as v,B as j}from"./BaseTable-CsPZTHSS.js";import{M as E}from"./ModalDelete-CfgHdyab.js";import{u as F}from"./useQuery-JHOG_8HK.js";import{u as h,S as l}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as q}from"./useReportes-fRvlvEg1.js";import{I as _}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const S=async e=>{try{return(await g.post("descuentos",e)).data}catch(o){throw console.error("Error al agregar registro:",o),new Error(o.response.data.message)}},C=async()=>{try{const e=await g.get("descuentos"),{data:o}=e;return o.map(s=>{const t=`${s.guardia.nombre} ${s.guardia.apellido_p} ${s.guardia.apellido_m}`,d=`$${s.monto}`,i={label:t,value:s.guardia.id},c=q(s.fecha).format("DD/MM/YYYY"),n={label:s.modulo_descuento.nombre,value:s.modulo_descuento.id},m=s.observaciones||"Ninguna",p=s.modulo_descuento.nombre;return{nombre:t,guardia_id:i,monto_format:d,fecha_descuento_format:c,modulo_descuento_id:n,observaciones_format:m,tipo_descuento:p,...s}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},O=async e=>{try{const{id:o}=e;return(await g.put(`descuentos/${o}`,e)).data}catch(o){throw console.error("Error al actualizar registro:",o),new Error(o.response.data.message)}},B=async e=>{try{return(await g.delete(`descuentos/${e}`)).data}catch(o){throw console.error("Error al eliminar registro:",o),new Error(o.response.data.message)}},I=()=>{const e=f(a=>a.modalType),o=f(a=>a.formData),s=f(a=>a.closeModal),t=D(),{isLoading:d,isError:i,data:c,error:n}=F({queryKey:["descuentos"],queryFn:C}),m=h({mutationFn:S,onSuccess:()=>{t.invalidateQueries({queryKey:["descuentos"]}),u.success("Registro agregado"),l.close(),s()},onError:a=>{l.close(),u.error(a.message)}}),p=h({mutationFn:O,onSuccess:()=>{t.invalidateQueries({queryKey:["descuentos"]}),u.success("Registro actualizado"),s(),l.close()},onError:a=>{u.error(a.message),l.close()}}),y=h({mutationFn:B,onSuccess:()=>{t.invalidateQueries({queryKey:["descuentos"]}),u.success("Registro eliminado")},onError:a=>{u.error(a.message)}});return{data:c,error:n,isError:i,isLoading:d,handleSubmit:a=>{a.preventDefault(),l.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{l.showLoading()}});const b={...o,guardia_id:o.guardia_id.value,modulo_descuento_id:o.modulo_descuento_id.value};e==="add"?m.mutate(b):e==="edit"&&p.mutate(b)},handleDelete:a=>{y.mutate(a),s()}}},T={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"async",label:"Tipo de descuento *",name:"modulo_descuento_id"},{required:!0,type:"number",step:"0.01",label:"Monto del descuento *",name:"monto"},{required:!0,type:"date",label:"Fecha del descuento *",name:"fecha"}]},$=()=>{const{view:e,formData:o,handleInputChange:s,loadOptionsTodosGuardias:t,loadOptionsModuloDescuento:d}=v();return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[T.generalFields.map(({type:i,label:c,name:n,required:m,step:p,opcSelect:y})=>r.jsx(_,{type:i,label:c,name:n,required:m,value:o[n]||"",step:p,opcSelect:y,onChange:s,loadOptions:n==="guardia_id"?t:d,disabled:e,classInput:"md:col-span-1"},n)),r.jsx(_,{type:"textarea",label:"Observaciones",name:"observaciones",required:!1,value:o.observaciones||"",onChange:s,disabled:e,classInput:"md:col-span-2"})]}),r.jsx("hr",{className:"text-gray-300"}),e?r.jsx(w,{}):r.jsx(x,{})]})},k=[{key:"nombre",name:"Guardia"},{key:"tipo_descuento",name:"Tipo de descuento"},{key:"monto_format",name:"Monto del descuento"},{key:"observaciones_format",name:"Observaciones"},{key:"fecha_descuento_format",name:"Fecha del descuento"}];function J(){const{modalType:e,currentItem:o}=v(),{data:s,isLoading:t,isError:d,error:i,handleSubmit:c,handleDelete:n}=I();return d?r.jsx("div",{children:i.message}):r.jsxs("div",{className:"md:p-4 bg-gray-100",children:[r.jsx(j,{columns:k,data:s||[],title:"Descuentos",loading:t}),(e==="add"||e==="edit"||e==="view")&&r.jsx(M,{handleSubmit:c,Inputs:r.jsx($,{})}),e==="delete"&&o&&r.jsx(E,{handleDelete:n})]})}export{J as default};
