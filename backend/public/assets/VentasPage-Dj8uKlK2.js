import{j as e,u as C,t as o}from"./index-CB-Ik059.js";import{I as g,C as w,B as N,a as M}from"./CancelButtonModal-DFIIInB4.js";import{d as b,I as S,u as x,J as q,K as _,L as k,M as E,N as D,B as F}from"./BaseTable-lMESkOGa.js";import{M as I}from"./ModalDelete-Bkq3cXQz.js";import{u as T}from"./configAxios-zIrC1_jU.js";import{u as p,S as d}from"./sweetalert2.esm.all-nsIXK1sI.js";import"./square-pen-D170uhu7.js";const V=({handleCancel:t})=>{const{closeModal:l,formData:s,handleInputChange:n}=b(),r=i=>{i.preventDefault(),t(s)};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",ocupacion:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-40 transition-opacity","aria-hidden":"true",onClick:l}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("form",{onSubmit:r,className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(S,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Cancelar venta"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"¿Estás seguro de realizar esta acción? No podrás retroceder."}),e.jsx(g,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada",required:!0,value:s.motivo_cancelada||"",onChange:n,disabled:!1,classInput:"md:col-span-2"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",className:"cursor-pointer w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar venta"}),e.jsx("button",{type:"button",onClick:l,className:"cursor-pointer mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cerrar ventana"})]})]})]})})},z={generalFields:[{required:!0,type:"async",label:"Selecciona la cotizacion *",name:"cotizacion_id"},{required:!0,type:"select",label:"Tipo de pago *",name:"tipo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"text",label:"Número de factura",name:"numero_factura"},{required:!0,type:"date",label:"Fecha de cotización aceptada",name:"fecha_emision"},{required:!0,type:"number",label:"Monto de la nota de credito *",name:"nota_credito"}]},B=()=>{const{view:t,edit:l,formData:s,handleInputChange:n,loadOptionsCotizaciones:r}=b();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[z.generalFields.map(({type:i,label:u,name:c,required:m,opcSelect:f})=>e.jsx(g,{type:i,label:u,name:c,required:m,value:s[c]||"",opcSelect:f,loadOptions:r,onChange:n,disabled:s.estatus==="Cancelada"?!0:t,classInput:"md:col-span-1"},c)),l&&e.jsx(g,{type:"select",label:"Estatus de la venta *",name:"estatus",required:!0,value:s.estatus||"",opcSelect:[{label:"Pendiente",value:"Pendiente"},{label:"Pagada",value:"Pagada"}],onChange:n,disabled:s.estatus==="Cancelada"?!0:t,classInput:"md:col-span-2"}),s.estatus==="Cancelada"&&e.jsx(g,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada",required:!1,value:s.motivo_cancelada||"",onChange:n,disabled:!0,classInput:"md:col-span-2"})]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(w,{}):e.jsx(N,{})]})},K=()=>{let t;const l=x(a=>a.modalType),s=x(a=>a.formData),n=x(a=>a.closeModal),r=C(),{isLoading:i,isError:u,data:c,error:m}=T({queryKey:["ventas"],queryFn:D}),f=p({mutationFn:k,onSuccess:()=>{r.invalidateQueries({queryKey:["ventas"]}),o.success("Registro agregado"),d.close(),n()},onError:a=>{d.close(),o.error(a.message)}}),v=p({mutationFn:E,onSuccess:()=>{r.invalidateQueries({queryKey:["ventas"]}),o.success("Registro actualizado"),n(),d.close()},onError:a=>{o.error(a.message),d.close()}}),y=p({mutationFn:q,onSuccess:()=>{r.invalidateQueries({queryKey:["ventas"]}),o.dismiss(t),o.warning("Venta cancelada"),n()},onError:a=>{o.dismiss(t),o.error(a.message)}}),j=p({mutationFn:_,onSuccess:()=>{r.invalidateQueries({queryKey:["ventas"]}),o.success("Registro eliminado")},onError:a=>{o.error(a.message)}});return{data:c,error:m,isError:u,isLoading:i,handleSubmit:a=>{a.preventDefault(),d.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{d.showLoading()}});const h={...s,cotizacion_id:s.cotizacion_id.value};l==="add"?f.mutate(h):l==="edit"&&v.mutate(h)},handleDelete:a=>{j.mutate(a),n()},handleCancel:a=>{t=o.loading("Cancelando venta..."),y.mutate(a)}}},P=[{key:"sucursal",name:"Sucursal"},{key:"numero_factura",name:"Número factura"},{key:"credito_dias",name:"Días de crédito"},{key:"fecha_vencimiento",name:"Limite de pago"},{key:"total",name:"Total"},{key:"estatus",name:"Estatus"}];function X(){const{modalType:t,currentItem:l}=b(),{data:s,isLoading:n,isError:r,error:i,handleSubmit:u,handleDelete:c,handleCancel:m}=K();return r?e.jsx("div",{children:i.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(F,{columns:P,data:s||[],title:"Ventas",loading:n}),(t==="add"||t==="edit"||t==="view")&&e.jsx(M,{handleSubmit:u,Inputs:e.jsx(B,{})}),t==="delete"&&l&&e.jsx(I,{handleDelete:c}),t==="cancelar"&&l&&e.jsx(V,{handleCancel:m})]})}export{X as default};
