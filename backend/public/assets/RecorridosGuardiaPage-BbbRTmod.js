import{a as d,u as w,t as s,j as t}from"./index-CrpPZsvu.js";import{a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as p,u as b,B as v}from"./BaseTable-CsPZTHSS.js";import{M}from"./ModalDelete-CfgHdyab.js";import{F as R}from"./FormGenerarQRS-Cjsop6yK.js";import{u as _}from"./useQuery-JHOG_8HK.js";import{u as g,S as n}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as S}from"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./InputField-CAlv3cmG.js";const j=async e=>{try{return(await d.post("recorridos-guardia",e)).data}catch(r){throw console.error("Error al agregar registro:",r),new Error(r.response.data.message)}},x=async()=>{try{const e=await d.get("recorridos-guardia"),{data:r}=e;return r.map(o=>({orden:o.punto.qr_generado.orden_servicio.codigo_orden_servicio,nombre:`${o.guardia.nombre} ${o.guardia.apellido_p} (${o.guardia.numero_empleado})`,fecha_format:S(o.fecha_escaneo).format("DD/MM/YYYY hh:mm:ss A"),nombre_punto:o.punto.nombre_punto,...o}))}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},D=async e=>{try{const{id:r}=e;return(await d.put(`recorridos-guardia/${r}`,e)).data}catch(r){throw console.error("Error al actualizar registro:",r),new Error(r.response.data.message)}},G=async e=>{try{return(await d.delete(`recorridos-guardia/${e}`)).data}catch(r){throw console.error("Error al eliminar registro:",r),new Error(r.response.data.message)}},F=()=>{const e=p(a=>a.modalType),r=p(a=>a.formData),o=p(a=>a.closeModal),i=w(),{isLoading:c,isError:u,data:l,error:m}=_({queryKey:["recorridos-guardia"],queryFn:x}),y=g({mutationFn:j,onSuccess:()=>{i.invalidateQueries({queryKey:["recorridos-guardia"]}),s.success("Registro agregado"),n.close(),o()},onError:a=>{n.close(),s.error(a.message)}}),f=g({mutationFn:D,onSuccess:()=>{i.invalidateQueries({queryKey:["recorridos-guardia"]}),s.success("Registro actualizado"),o(),n.close()},onError:a=>{s.error(a.message),n.close()}}),h=g({mutationFn:G,onSuccess:()=>{i.invalidateQueries({queryKey:["recorridos-guardia"]}),s.success("Registro eliminado")},onError:a=>{s.error(a.message)}});return{data:l,error:m,isError:u,isLoading:c,handleSubmit:a=>{a.preventDefault(),n.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{n.showLoading()}}),e==="add"?y.mutate(r):e==="edit"&&f.mutate(r)},handleDelete:a=>{h.mutate(a),o()}}},q=[{key:"orden",name:"Orden de servicio"},{key:"nombre",name:"Guardia"},{key:"nombre_punto",name:"Escaneo"},{key:"fecha_format",name:"Fecha de escaneo"},{key:"observaciones",name:"Observaciones"}];function P(){const{modalType:e,currentItem:r}=b(),{data:o,isLoading:i,isError:c,error:u,handleSubmit:l,handleDelete:m}=F();return c?t.jsx("div",{children:u.message}):t.jsxs("div",{className:"md:p-4 bg-gray-100",children:[t.jsx(v,{columns:q,data:o||[],title:"Recorridos guardados de los guardias",loading:i}),(e==="add"||e==="edit"||e==="view")&&t.jsx(E,{handleSubmit:l,Inputs:t.jsx(R,{})}),e==="delete"&&r&&t.jsx(M,{handleDelete:m})]})}export{P as default};
