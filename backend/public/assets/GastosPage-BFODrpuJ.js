import{j as o,u as x,t as l}from"./index-CB-Ik059.js";import{I as w,C as j,B as E,a as M}from"./CancelButtonModal-DFIIInB4.js";import{d as v,k as S,u as y,B as D}from"./BaseTable-lMESkOGa.js";import{M as q}from"./ModalDelete-Bkq3cXQz.js";import{A as C}from"./AlertaCard-azZSUJ8e.js";import{S as F}from"./SwitchInput-By6EEQXs.js";import{a as g,u as B}from"./configAxios-zIrC1_jU.js";import{u as b,S as c}from"./sweetalert2.esm.all-nsIXK1sI.js";import"./square-pen-D170uhu7.js";const T={generalFields:[{required:!0,type:"async",label:"Selecciona el banco *",name:"banco_id"},{required:!0,type:"text",label:"Concepto *",name:"concepto"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"number",step:"0.01",label:"Subtotal *",name:"subtotal"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"total"}]},I=()=>{const{view:e,formData:a,handleInputChange:s,loadOptionsBancos:r}=v();return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[o.jsx(F,{value:"impuesto",card:"Impuesto",text:"¿Pago + IVA?"}),o.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:o.jsx(C,{text:"Datos de gastos"})}),T.generalFields.map(({type:i,label:d,name:n,required:u,step:m,opcSelect:p})=>o.jsx(w,{type:i,label:d,name:n,step:m,required:u,value:a[n]||"",opcSelect:p,loadOptions:r,onChange:s,disabled:e,classInput:"md:col-span-1"},n))]}),o.jsx("hr",{className:"text-gray-300"}),e?o.jsx(j,{}):o.jsx(E,{})]})},_=async e=>{try{return(await g.post("gastos",e)).data}catch(a){throw console.error("Error al crear el registro",a),new Error(a.response.data.message)}},G=async()=>{try{const e=await g.get("gastos"),{data:a}=e;return Array.isArray(a)?a.map(r=>({...r,banco_id:{label:r.banco.nombre,value:r.banco.id},banco:r.banco.nombre,total_format:`$${r.total}`,fecha:S(r.created_at).format("DD/MM/YYYY")})):[]}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},k=async e=>{try{const{id:a}=e;return(await g.put(`gastos/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},A=async e=>{try{return(await g.delete(`gastos/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},K=()=>{const e=y(t=>t.modalType),a=y(t=>t.formData),s=y(t=>t.closeModal),r=x(),{isError:i,data:d,error:n,isLoading:u}=B({queryKey:["gastos"],queryFn:G}),m=b({mutationFn:_,onSuccess:()=>{r.invalidateQueries({queryKey:["gastos"]}),l.success("Registro agregado"),s(),c.close()},onError:t=>{l.error(t.message),c.close()}}),p=b({mutationFn:k,onSuccess:()=>{r.invalidateQueries({queryKey:["gastos"]}),l.success("Registro actualizado"),s(),c.close()},onError:t=>{l.error(t.message),c.close()}}),f=b({mutationFn:A,onSuccess:()=>{r.invalidateQueries({queryKey:["gastos"]}),l.success("Registro eliminado")},onError:t=>{l.error(t.message)}});return{isLoading:u,isError:i,data:d,error:n,createMutation:m,updateMutation:p,deleteMutation:f,handleSubmit:t=>{t.preventDefault(),c.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{c.showLoading()}});const h={...a,banco_id:a.banco_id.value};e==="add"?m.mutate(h):e==="edit"&&p.mutate(h)},handleDelete:t=>{f.mutate(t),s()}}},O=[{key:"banco",name:"Banco"},{key:"concepto",name:"Concepto"},{key:"metodo_pago",name:"Método de pago"},{key:"total_format",name:"Total"},{key:"fecha",name:"Fecha"}];function U(){const{modalType:e,currentItem:a}=v(),{data:s,isLoading:r,isError:i,error:d,handleSubmit:n,handleDelete:u}=K();return i?o.jsx("div",{children:d.message}):o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(D,{columns:O,data:s||[],title:"Gastos",loading:r}),(e==="add"||e==="edit"||e==="view")&&o.jsx(M,{handleSubmit:n,Inputs:o.jsx(I,{})}),e==="delete"&&a&&o.jsx(q,{handleDelete:u})]})}export{U as default};
