import{a as m,u as w,t as l,j as o}from"./index-CrpPZsvu.js";import{C as x,B as M,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as g,u as _,B as E}from"./BaseTable-CsPZTHSS.js";import{M as I}from"./ModalDelete-CfgHdyab.js";import{u as D}from"./useQuery-JHOG_8HK.js";import{u as f,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as h}from"./useReportes-fRvlvEg1.js";import{I as F}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const q=async e=>{try{return(await m.post("incapacidades",e)).data}catch(a){throw console.error("Error al agregar registro:",a),new Error(a.response.data.message)}},S=async()=>{try{const e=await m.get("incapacidades"),{data:a}=e;return a.map(r=>{const t=`${r.guardia.nombre} ${r.guardia.apellido_p} ${r.guardia.apellido_m}`,i=h(r.fecha_inicio).format("DD/MM/YYYY"),d=h(r.fecha_fin).format("DD/MM/YYYY"),n=`$${r.pago_empresa}`,c={label:t,value:r.guardia.id};return{nombre:t,guardia_id:c,fecha_inicio_format:i,fecha_fin_format:d,pago_empresa_format:n,...r}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},C=async e=>{try{const{id:a}=e;return(await m.put(`incapacidades/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},Y=async e=>{try{return(await m.delete(`incapacidades/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},B=()=>{const e=g(s=>s.modalType),a=g(s=>s.formData),r=g(s=>s.closeModal),t=w(),{isLoading:i,isError:d,data:n,error:c}=D({queryKey:["incapacidades"],queryFn:S}),p=f({mutationFn:q,onSuccess:()=>{t.invalidateQueries({queryKey:["incapacidades"]}),l.success("Registro agregado"),u.close(),r()},onError:s=>{u.close(),l.error(s.message)}}),b=f({mutationFn:C,onSuccess:()=>{t.invalidateQueries({queryKey:["incapacidades"]}),l.success("Registro actualizado"),r(),u.close()},onError:s=>{l.error(s.message),u.close()}}),v=f({mutationFn:Y,onSuccess:()=>{t.invalidateQueries({queryKey:["incapacidades"]}),l.success("Registro eliminado")},onError:s=>{l.error(s.message)}});return{data:n,error:c,isError:d,isLoading:i,handleSubmit:s=>{s.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const y={...a,guardia_id:a.guardia_id.value};e==="add"?p.mutate(y):e==="edit"&&b.mutate(y)},handleDelete:s=>{v.mutate(s),r()}}},$={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"date",label:"Fecha de inicio *",name:"fecha_inicio"},{required:!0,type:"date",label:"Fecha de fin *",name:"fecha_fin"},{required:!1,type:"number",step:"0.01",label:"Pago por parte de la empresa",name:"pago_empresa"},{required:!1,type:"textarea",label:"Motivo",name:"motivo"},{required:!1,type:"textarea",label:"Observaciones",name:"observaciones"}]},k=()=>{const{view:e,formData:a,handleInputChange:r,loadOptionsTodosGuardias:t}=_();return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:$.generalFields.map(({type:i,label:d,name:n,required:c,step:p})=>o.jsx(F,{type:i,label:d,name:n,required:c,value:a[n]||"",step:p,onChange:r,loadOptions:t,disabled:e,classInput:"md:col-span-2"},n))}),o.jsx("hr",{className:"text-gray-300"}),e?o.jsx(x,{}):o.jsx(M,{})]})},O=[{key:"nombre",name:"Guardia"},{key:"fecha_inicio_format",name:"Inicio de incapacidad"},{key:"fecha_fin_format",name:"Fin de incapacidad"},{key:"pago_empresa_format",name:"Pago por parte de la empresa"},{key:"motivo",name:"Motivo de incapacidad"}];function J(){const{modalType:e,currentItem:a}=_(),{data:r,isLoading:t,isError:i,error:d,handleSubmit:n,handleDelete:c}=B();return i?o.jsx("div",{children:d.message}):o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(E,{columns:O,data:r||[],title:"Incapacidades",loading:t}),(e==="add"||e==="edit"||e==="view")&&o.jsx(j,{handleSubmit:n,Inputs:o.jsx(k,{})}),e==="delete"&&a&&o.jsx(I,{handleDelete:c})]})}export{J as default};
