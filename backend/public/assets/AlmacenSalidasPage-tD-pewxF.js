import{a as _,u as w,t as p,j as s}from"./index-CrpPZsvu.js";import{C as S,B as M,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as y,u as h,B as O}from"./BaseTable-CsPZTHSS.js";import{u as A}from"./useQuery-JHOG_8HK.js";import{u as f,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as D,g as E}from"./useReportes-fRvlvEg1.js";import{a as q}from"./almacen-DLf8uXGr.js";import{I as v}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const F=async r=>{try{return(await _.post("almacen-salidas",r)).data}catch(a){throw console.error("Error al crear el registro",a),new Error(a.response.data.message)}},C=async()=>{try{const r=await _.get("almacen-salidas"),{data:a}=r;return a.map(e=>{var i,n;return{...e,guardia_id:{label:((i=e==null?void 0:e.guardia)==null?void 0:i.nombre)||null,value:((n=e==null?void 0:e.guardia)==null?void 0:n.id)||null},articulo_id:{label:`${e.articulo.nombre} (${e.numero_serie})`,value:`${e.numero_serie}`,id:e.articulo.id},articulo:e.articulo.nombre,numero_serie:e.numero_serie,fecha_salida_format:D(e.fecha_salida,"YYYY-MM-DD").format("DD/MM/YYYY")}})}catch(r){throw console.error("Error al obetener el registro",r),new Error(r.response.data.message)}},Y=async r=>{try{const{id:a}=r;return(await _.put(`almacen-salidas/${a}`,r)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},x=()=>{const r=y(o=>o.modalType),a=y(o=>o.formData),e=y(o=>o.closeModal),i=w(),{isError:n,data:d,error:g,isLoading:l}=A({queryKey:["salidas"],queryFn:C}),c=f({mutationFn:F,onSuccess:()=>{i.invalidateQueries({queryKey:["salidas"]}),p.success("Registro agregado"),e(),u.close()},onError:o=>{p.error(o.message),u.close()}}),m=f({mutationFn:Y,onSuccess:()=>{i.invalidateQueries({queryKey:["salidas"]}),p.success("Registro actualizado"),e(),u.close()},onError:o=>{p.error(o.message),u.close()}});return{isLoading:l,isError:n,data:d,error:g,createMutation:c,updateMutation:m,handleSubmit:o=>{var b;o.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const t={...a,articulo_id:a.articulo_id.id,numero_serie:a.articulo_id.numero_serie,guardia_id:((b=a.guardia_id)==null?void 0:b.value)||null};r==="add"?c.mutate(t):r==="edit"&&m.mutate(t)},loadOptionsArticulos:async()=>{try{return(await q()).map(t=>({label:`${t.articulo.nombre} (${t.numero_serie})`,value:`${t.numero_serie}`,id:t.articulo.id,numero_serie:t.numero_serie}))}catch(o){return console.error("Error cargando registros:",o),[]}},loadOptionsGuardias:async()=>{try{return(await E()).map(t=>({value:t.id,label:t.nombre_completo}))}catch(o){return console.error("Error cargando registros:",o),[]}}}},B={generalFields:[{required:!0,type:"async",label:"Selecciona el artículo *",name:"articulo_id"},{required:!0,type:"text",label:"Número de serie *",name:"numero_serie"},{required:!0,type:"date",label:"Fecha de salida *",name:"fecha_salida"},{required:!1,type:"select",label:"Mótivo de salida *",name:"motivo_salida",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Asignado",value:"Asignado"},{label:"Devolución a proveedor",value:"Devolución a proveedor"},{label:"Venta",value:"Venta"},{label:"Destrucción",value:"Destrucción"},{label:"Mantenimiento",value:"Mantenimiento"},{label:"Robo",value:"Robo"},{label:"Pérdida",value:"Pérdida"},{label:"Otro",value:"Otro"}]}]},I=()=>{const{view:r,formData:a,handleInputChange:e}=h(),{loadOptionsArticulos:i,loadOptionsGuardias:n}=x();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[B.generalFields.map(({type:d,label:g,name:l,required:c,opcSelect:m})=>s.jsx(v,{type:d,label:g,name:l,required:c,value:a[l]||"",opcSelect:m,loadOptions:i,onChange:e,disabled:l==="numero_serie"?!0:r,classInput:"md:col-span-1"},l)),a.motivo_salida==="Otro"&&s.jsx(v,{type:"text",label:"Otro(s) motivo(s) *",name:"motivo_salida_otro",required:!0,value:a.motivo_salida_otro||"",onChange:e,disabled:r,classInput:"md:col-span-1"}),a.motivo_salida==="Asignado"&&s.jsx(v,{type:"async",label:"Selecciona al guardia a quien se le asignó el equipo *",name:"guardia_id",required:!0,value:a.guardia_id||"",onChange:e,loadOptions:n,disabled:r,classInput:"md:col-span-1"})]}),s.jsx("hr",{className:"text-gray-300"}),r?s.jsx(S,{}):s.jsx(M,{})]})},$=[{key:"articulo",name:"Artículo"},{key:"numero_serie",name:"Número de serie"},{key:"fecha_salida_format",name:"Fecha de salida"},{key:"motivo_salida",name:"Mótivo de salida"}];function J(){const{modalType:r}=h(),{data:a,isLoading:e,isError:i,error:n,handleSubmit:d}=x();return i?s.jsx("div",{children:n.message}):s.jsxs("div",{className:"md:p-4 bg-gray-100",children:[s.jsx(O,{columns:$,data:a||[],title:"Historial de salidas en almacén",loading:e}),(r==="add"||r==="edit"||r==="view")&&s.jsx(j,{handleSubmit:d,Inputs:s.jsx(I,{})})]})}export{J as default};
