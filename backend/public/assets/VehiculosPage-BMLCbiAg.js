import{j as a,u as F,t as d}from"./index-CB-Ik059.js";import{I as h,C as M,B as I,a as j}from"./CancelButtonModal-DFIIInB4.js";import{d as q,u as y,g as C,B as O}from"./BaseTable-lMESkOGa.js";import{M as _}from"./ModalDelete-Bkq3cXQz.js";import{u as N}from"./configAxios-zIrC1_jU.js";import{u as f,S as m}from"./sweetalert2.esm.all-nsIXK1sI.js";import{r as D,u as E,c as V,g as k}from"./vehiculos-BJbokqmd.js";import"./square-pen-D170uhu7.js";const x={generalFields:[{required:!0,type:"select",label:"Tipo de vehículo *",name:"tipo_vehiculo",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Carro",value:"Carro"},{label:"Motocicleta",value:"Motocicleta"}]},{required:!0,type:"text",label:"Marca *",name:"marca"},{required:!0,type:"text",label:"Modelo *",name:"modelo"},{required:!0,type:"text",label:"Color *",name:"color"},{required:!0,type:"text",label:"Placas *",name:"placas"},{required:!0,type:"file",multiple:!0,label:"Fotos del vehículo *",name:"fotos_vehiculo",accept:"image/*"},{required:!0,type:"select",label:"Rotulado *",name:"rotulado",opcSelect:[{label:"Selecciona una opción",value:""},{label:"SI",value:"SI"},{label:"NO",value:"NO"}]},{required:!0,type:"select",label:"GPS *",name:"gps",opcSelect:[{label:"Selecciona una opción",value:""},{label:"SI",value:"SI"},{label:"NO",value:"NO"}]},{required:!0,type:"select",label:"Torreta *",name:"torreta",opcSelect:[{label:"Selecciona una opción",value:""},{label:"SI",value:"SI"},{label:"NO",value:"NO"}]},{required:!0,type:"select",label:"Impuestos pagados *",name:"impuestos_pagados",opcSelect:[{label:"Selecciona una opción",value:""},{label:"SI",value:"SI"},{label:"NO",value:"NO"}]}],seguroFields:[{required:!0,type:"text",label:"Aseguradora *",name:"aseguradora"},{required:!0,type:"number",label:"Teléfono de la aseguradora *",name:"telefono_aseguradora"},{required:!0,type:"file",label:"Póliza de seguro (PDF) *",name:"archivo_seguro",accept:"application/pdf"},{required:!0,type:"text",label:"Número de póliza *",name:"numero_poliza"},{required:!0,type:"date",label:"Fecha de vencimiento del seguro *",name:"fecha_vencimiento"}]},T=()=>{const{view:l,edit:i,document:s,formData:r,handleInputChange:u,handleMultipleFilesChange:p,handleFileChange:g}=q();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[x.generalFields.map(({type:t,label:n,name:o,opcSelect:c,accept:b,multiple:S})=>a.jsx(h,{type:t,label:n,name:o,multiple:S,required:!s,value:r[o]||"",opcSelect:c,accept:b,onChange:t==="file"?p:u,disabled:l,document:t==="file"?r[`${o}_url`]||null:!1,classInput:"md:col-span-1"},o)),x.seguroFields.map(({type:t,label:n,name:o,opcSelect:c,accept:b})=>a.jsx(h,{type:t,label:n,name:o,required:!s,value:r[o]||"",opcSelect:c,accept:b,onChange:t==="file"?g:u,disabled:l,document:t==="file"?r[`${o}_url`]||null:!1,classInput:"md:col-span-1"},o)),i&&a.jsx(h,{type:"select",label:"Selecciona el estado del vehículo *",name:"estado",required:!0,value:r.estado||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Disponible",value:"Disponible"},{label:"Asignado",value:"Asignado"},{label:"En reparación",value:"En reparación"},{label:"Fuera de servicio",value:"Fuera de servicio"},{label:"Accidente",value:"Accidente"},{label:"Robado",value:"Robado"},{label:"Vendido",value:"Vendido"}],onChange:u,disabled:l,classInput:"md:col-span-1"})]}),a.jsx("hr",{className:"text-gray-300"}),l?a.jsx(M,{}):a.jsx(I,{})]})},w=()=>{const l=y(e=>e.modalType),i=y(e=>e.formData),s=y(e=>e.closeModal),r=F(),{isError:u,data:p,error:g,isLoading:t}=N({queryKey:["vehiculos"],queryFn:k}),n=f({mutationFn:V,onSuccess:()=>{r.invalidateQueries({queryKey:["vehiculos"]}),d.success("Registro agregado"),s(),m.close()},onError:e=>{d.error(e.message),m.close()}}),o=f({mutationFn:E,onSuccess:()=>{r.invalidateQueries({queryKey:["vehiculos"]}),d.success("Registro actualizado"),s(),m.close()},onError:e=>{d.error(e.message),m.close()}}),c=f({mutationFn:D,onSuccess:()=>{r.invalidateQueries({queryKey:["vehiculos"]}),d.success("Registro eliminado")},onError:e=>{d.error(e.message)}});return{isLoading:t,isError:u,data:p,error:g,createMutation:n,updateMutation:o,deleteMutation:c,handleSubmit:e=>{e.preventDefault(),m.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{m.showLoading()}}),l==="add"?n.mutate(i):l==="edit"&&o.mutate(i)},handleDelete:e=>{c.mutate(e),s()},loadOptions:async()=>{try{return(await C()).map(v=>({value:v.id,label:`${v.nombre} ${v.apellido_p} ${v.apellido_m}`}))}catch(e){return console.error("Error cargando empleados:",e),[]}}}},B=[{key:"tipo_vehiculo",name:"Vehículo"},{key:"marca",name:"Marca"},{key:"modelo",name:"Modelo"},{key:"placas",name:"Placas"},{key:"aseguradora",name:"Aseguradora"},{key:"telefono_aseguradora",name:"Teléfono"},{key:"estado",name:"Estado"}];function H(){const{modalType:l,currentItem:i}=q(),{data:s,isLoading:r,isError:u,error:p,handleSubmit:g,handleDelete:t}=w();return u?a.jsx("div",{children:p.message}):a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(O,{columns:B,data:s||[],title:"Vehículos",loading:r}),(l==="add"||l==="edit"||l==="view")&&a.jsx(j,{handleSubmit:g,Inputs:a.jsx(T,{})}),l==="delete"&&i&&a.jsx(_,{handleDelete:t})]})}export{H as default};
