import{a as m,u as w,t as d,j as o}from"./index-CrpPZsvu.js";import{C as x,B as M,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as g,u as v,B as D}from"./BaseTable-CsPZTHSS.js";import{M as E}from"./ModalDelete-CfgHdyab.js";import{u as F}from"./useQuery-JHOG_8HK.js";import{u as f,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as h}from"./useReportes-fRvlvEg1.js";import{I as q}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const S=async e=>{try{return(await m.post("vacaciones",e)).data}catch(a){throw console.error("Error al agregar registro:",a),new Error(a.response.data.message)}},C=async()=>{try{const e=await m.get("vacaciones"),{data:a}=e;return a.map(r=>{const t=`${r.guardia.nombre} ${r.guardia.apellido_p} ${r.guardia.apellido_m}`,i=h(r.fecha_inicio).format("DD/MM/YYYY"),c=h(r.fecha_fin).format("DD/MM/YYYY"),n=`$${r.prima_vacacional}`,l={label:t,value:r.guardia.id};return{nombre:t,guardia_id:l,fecha_inicio_format:i,fecha_fin_format:c,prima_vacacional_format:n,...r}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},V=async e=>{try{const{id:a}=e;return(await m.put(`vacaciones/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},Y=async e=>{try{return(await m.delete(`vacaciones/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},$=()=>{const e=g(s=>s.modalType),a=g(s=>s.formData),r=g(s=>s.closeModal),t=w(),{isLoading:i,isError:c,data:n,error:l}=F({queryKey:["vacaciones"],queryFn:C}),p=f({mutationFn:S,onSuccess:()=>{t.invalidateQueries({queryKey:["vacaciones"]}),d.success("Registro agregado"),u.close(),r()},onError:s=>{u.close(),d.error(s.message)}}),_=f({mutationFn:V,onSuccess:()=>{t.invalidateQueries({queryKey:["vacaciones"]}),d.success("Registro actualizado"),r(),u.close()},onError:s=>{d.error(s.message),u.close()}}),b=f({mutationFn:Y,onSuccess:()=>{t.invalidateQueries({queryKey:["vacaciones"]}),d.success("Registro eliminado")},onError:s=>{d.error(s.message)}});return{data:n,error:l,isError:c,isLoading:i,handleSubmit:s=>{s.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const y={...a,guardia_id:a.guardia_id.value};e==="add"?p.mutate(y):e==="edit"&&_.mutate(y)},handleDelete:s=>{b.mutate(s),r()}}},B={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"date",label:"Fecha de inicio *",name:"fecha_inicio"},{required:!0,type:"date",label:"Fecha de fin *",name:"fecha_fin"},{required:!0,type:"number",label:"Días totales de vacaciones *",name:"dias_totales"},{required:!1,type:"number",step:"0.01",label:"Prima vacacional ($)",name:"prima_vacacional"},{required:!1,type:"textarea",label:"Observaciones",name:"observaciones"}]},I=()=>{const{view:e,formData:a,handleInputChange:r,loadOptionsTodosGuardias:t}=v();return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:B.generalFields.map(({type:i,label:c,name:n,required:l,step:p})=>o.jsx(q,{type:i,label:c,name:n,required:l,value:a[n]||"",step:p,onChange:r,loadOptions:t,disabled:e,classInput:"md:col-span-2"},n))}),o.jsx("hr",{className:"text-gray-300"}),e?o.jsx(x,{}):o.jsx(M,{})]})},k=[{key:"nombre",name:"Guardia"},{key:"fecha_inicio_format",name:"Inicio de vacaciones"},{key:"fecha_fin_format",name:"Fin de vacaciones"},{key:"dias_totales",name:"Días totales de vacaciones"},{key:"prima_vacacional_format",name:"Prima vacacional"}];function H(){const{modalType:e,currentItem:a}=v(),{data:r,isLoading:t,isError:i,error:c,handleSubmit:n,handleDelete:l}=$();return i?o.jsx("div",{children:c.message}):o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(D,{columns:k,data:r||[],title:"Vacaciones",loading:t}),(e==="add"||e==="edit"||e==="view")&&o.jsx(j,{handleSubmit:n,Inputs:o.jsx(I,{})}),e==="delete"&&a&&o.jsx(E,{handleDelete:l})]})}export{H as default};
