import{a as u,u as M,t as i,j as t}from"./index-CrpPZsvu.js";import{C as w,B as x,a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as b,u as v,B as j}from"./BaseTable-CsPZTHSS.js";import{M as B}from"./ModalDelete-CfgHdyab.js";import{u as q}from"./useQuery-JHOG_8HK.js";import{u as y,S as c}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as S}from"./useReportes-fRvlvEg1.js";import{I as D}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const C=async e=>{try{return(await u.post("movimientos-bancarios",e)).data}catch(a){throw console.error("Error al agregar registro:",a),new Error(a.response.data.message)}},F=async()=>{try{const e=await u.get("movimientos-bancarios"),{data:a}=e;return Array.isArray(a)?a.map(r=>({...r,banco_id:{label:r.banco.nombre,value:r.banco.id},banco:r.banco.nombre,monto_format:`$${r.monto}`,fecha_format:S(r.fecha).format("DD/MM/YYYY")})):[]}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},_=async e=>{try{const{id:a}=e;return(await u.put(`movimientos-bancarios/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},T=async e=>{try{return(await u.delete(`movimientos-bancarios/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},I=()=>{const e=b(o=>o.modalType),a=b(o=>o.formData),s=b(o=>o.closeModal),r=M(),{isLoading:l,isError:m,data:n,error:d}=q({queryKey:["movimientos"],queryFn:F}),p=y({mutationFn:C,onSuccess:()=>{r.invalidateQueries({queryKey:["movimientos"]}),i.success("Registro agregado"),c.close(),s()},onError:o=>{c.close(),i.error(o.message)}}),g=y({mutationFn:_,onSuccess:()=>{r.invalidateQueries({queryKey:["movimientos"]}),i.success("Registro actualizado"),s(),c.close()},onError:o=>{i.error(o.message),c.close()}}),h=y({mutationFn:T,onSuccess:()=>{r.invalidateQueries({queryKey:["movimientos"]}),i.success("Registro eliminado")},onError:o=>{i.error(o.message)}});return{data:n,error:d,isError:m,isLoading:l,handleSubmit:o=>{o.preventDefault(),c.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{c.showLoading()}});const f={...a,banco_id:a.banco_id.value};e==="add"?p.mutate(f):e==="edit"&&g.mutate(f)},handleDelete:o=>{h.mutate(o),s()}}},k={generalFields:[{required:!0,type:"async",label:"Selecciona el banco *",name:"banco_id"},{required:!0,type:"select",label:"Tipo de movimiento *",name:"tipo_movimiento",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Ingreso",value:"Ingreso"},{label:"Egreso",value:"Egreso"}]},{required:!0,type:"text",label:"Concepo *",name:"concepto"},{required:!0,type:"date",label:"Fecha del movimiento *",name:"fecha"},{required:!1,type:"text",label:"Referencia *",name:"referencia"},{required:!0,type:"number",label:"Monto *",step:"0.01",name:"monto"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]}]},R=()=>{const{view:e,formData:a,handleInputChange:s,loadOptionsBancos:r}=v();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:k.generalFields.map(({type:l,label:m,name:n,required:d,step:p,opcSelect:g})=>t.jsx(D,{type:l,label:m,name:n,step:p,required:d,value:a[n]||"",opcSelect:g,loadOptions:r,onChange:s,disabled:e,classInput:"md:col-span-1"},n))}),t.jsx("hr",{className:"text-gray-300"}),e?t.jsx(w,{}):t.jsx(x,{})]})},K=[{key:"banco",name:"Banco"},{key:"tipo_movimiento",name:"Tipo movimiento"},{key:"concepto",name:"Concepto"},{key:"referencia",name:"Referencia"},{key:"monto_format",name:"Monto"},{key:"fecha_format",name:"Fecha movimiento"}];function J(){const{modalType:e,currentItem:a}=v(),{data:s,isLoading:r,isError:l,error:m,handleSubmit:n,handleDelete:d}=I();return l?t.jsx("div",{children:m.message}):t.jsxs("div",{className:"md:p-4 bg-gray-100",children:[t.jsx(j,{columns:K,data:s||[],title:"Movimientos bancarios",loading:r}),(e==="add"||e==="edit"||e==="view")&&t.jsx(E,{handleSubmit:n,Inputs:t.jsx(R,{})}),e==="delete"&&a&&t.jsx(B,{handleDelete:d})]})}export{J as default};
