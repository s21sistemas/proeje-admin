import{u as x,t as i,j as a}from"./index-CrpPZsvu.js";import{C as q,B as F,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as y,V as M,W as P,X as S,Y as D,u as v,B as E}from"./BaseTable-CsPZTHSS.js";import{M as k}from"./ModalDelete-CfgHdyab.js";import{u as C}from"./useQuery-JHOG_8HK.js";import{u as f,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{I as _}from"./InputField-CAlv3cmG.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";const w=()=>{const t=y(e=>e.modalType),o=y(e=>e.formData),r=y(e=>e.closeModal),l=x(),{isLoading:m,isError:c,data:d,error:n}=C({queryKey:["prestamos"],queryFn:D}),s=f({mutationFn:P,onSuccess:()=>{l.invalidateQueries({queryKey:["prestamos"]}),i.success("Registro agregado"),u.close(),r()},onError:e=>{u.close(),i.error(e.message)}}),p=f({mutationFn:S,onSuccess:()=>{l.invalidateQueries({queryKey:["prestamos"]}),i.success("Registro actualizado"),r(),u.close()},onError:e=>{i.error(e.message),u.close()}}),g=f({mutationFn:M,onSuccess:()=>{l.invalidateQueries({queryKey:["prestamos"]}),i.success("Registro eliminado")},onError:e=>{i.error(e.message)}});return{data:d,error:n,isError:c,isLoading:m,handleSubmit:e=>{e.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const h={...o,guardia_id:o.guardia_id.value,modulo_prestamo_id:o.modulo_prestamo_id.value};t==="add"?s.mutate(h):t==="edit"&&p.mutate(h)},handleDelete:e=>{g.mutate(e),r()}}},b={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"number",step:"0.01",label:"Monto del prestamo *",name:"monto_total"},{required:!0,type:"number",label:"Número de pagos acordados *",name:"numero_pagos"},{required:!0,type:"date",label:"Fecha del prestamo *",name:"fecha_prestamo"},{required:!0,type:"async",label:"Selecciona el motivo *",name:"modulo_prestamo_id"},{required:!1,type:"textarea",label:"Observaciones",name:"observaciones"}],editFields:[{required:!1,type:"date",label:"Fecha del préstamo liquidado",name:"fecha_pagado"},{required:!0,type:"select",label:"Estatus",name:"estatus",opcSelect:[{label:"Pendiente",value:"Pendiente"},{label:"Pagado",value:"Pagado"}]}]},B=()=>{const{view:t,document:o,formData:r,handleInputChange:l,loadOptionsTodosGuardias:m,loadOptionsModuloPrestamo:c}=v();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[b.generalFields.map(({type:d,label:n,name:s,required:p,step:g})=>a.jsx(_,{type:d,label:n,name:s,required:p,value:r[s]||"",step:g,onChange:l,loadOptions:s==="guardia_id"?m:c,disabled:["monto_total","guardia_id","numero_pagos","fecha_prestamo"].includes(s)&&o?!0:t,classInput:"md:col-span-2"},s)),o&&b.editFields.map(({type:d,label:n,name:s,required:p,opcSelect:g})=>a.jsx(_,{type:d,label:n,name:s,required:p,value:r[s]||"",opcSelect:g,onChange:l,disabled:!0},s))]}),a.jsx("hr",{className:"text-gray-300"}),t?a.jsx(q,{}):a.jsx(F,{})]})},O=[{key:"nombre",name:"Guardia"},{key:"monto_total_format",name:"Monto prestado"},{key:"saldo_restante_format",name:"Saldo restante"},{key:"fecha_prestamo_format",name:"Fecha del préstamo"},{key:"cuotas",name:"Abonos pagados"},{key:"fecha_pagado_format",name:"Fecha prestamo liquidado"},{key:"estatus",name:"Estatus"}];function W(){const{modalType:t,currentItem:o}=v(),{data:r,isLoading:l,isError:m,error:c,handleSubmit:d,handleDelete:n}=w();return m?a.jsx("div",{children:c.message}):a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(E,{columns:O,data:r||[],title:"Préstamos",loading:l}),(t==="add"||t==="edit"||t==="view")&&a.jsx(j,{handleSubmit:d,Inputs:a.jsx(B,{})}),t==="delete"&&o&&a.jsx(k,{handleDelete:n})]})}export{W as default};
