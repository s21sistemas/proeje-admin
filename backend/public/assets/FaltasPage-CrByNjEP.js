import{a as m,u as w,t as c,j as t}from"./index-CrpPZsvu.js";import{C as x,B as M,a as j}from"./CancelButtonModal-BoD_aq40.js";import{a as f,u as _,B as E}from"./BaseTable-CsPZTHSS.js";import{M as v}from"./ModalDelete-CfgHdyab.js";import{u as D}from"./useQuery-JHOG_8HK.js";import{u as g,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as h}from"./useReportes-fRvlvEg1.js";import{I as q}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const C=async e=>{try{return(await m.post("faltas",e)).data}catch(a){throw console.error("Error al agregar registro:",a),new Error(a.response.data.message)}},S=async()=>{try{const e=await m.get("faltas"),{data:a}=e;return a.map(r=>{const s=`${r.guardia.nombre} ${r.guardia.apellido_p} ${r.guardia.apellido_m}`,i=h(r.fecha_inicio).format("DD/MM/YYYY"),d=h(r.fecha_fin).format("DD/MM/YYYY"),n=`$${r.monto}`,l={label:s,value:r.guardia.id};return{nombre:s,guardia_id:l,fecha_inicio_format:i,fecha_fin_format:d,monto_format:n,...r}})}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},Y=async e=>{try{const{id:a}=e;return(await m.put(`faltas/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},B=async e=>{try{return(await m.delete(`faltas/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},I=()=>{const e=f(o=>o.modalType),a=f(o=>o.formData),r=f(o=>o.closeModal),s=w(),{isLoading:i,isError:d,data:n,error:l}=D({queryKey:["faltas"],queryFn:S}),p=g({mutationFn:C,onSuccess:()=>{s.invalidateQueries({queryKey:["faltas"]}),c.success("Registro agregado"),u.close(),r()},onError:o=>{u.close(),c.error(o.message)}}),F=g({mutationFn:Y,onSuccess:()=>{s.invalidateQueries({queryKey:["faltas"]}),c.success("Registro actualizado"),r(),u.close()},onError:o=>{c.error(o.message),u.close()}}),b=g({mutationFn:B,onSuccess:()=>{s.invalidateQueries({queryKey:["faltas"]}),c.success("Registro eliminado")},onError:o=>{c.error(o.message)}});return{data:n,error:l,isError:d,isLoading:i,handleSubmit:o=>{o.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const y={...a,guardia_id:a.guardia_id.value};e==="add"?p.mutate(y):e==="edit"&&F.mutate(y)},handleDelete:o=>{b.mutate(o),r()}}},$={generalFields:[{required:!0,type:"async",label:"Selecciona al guardia *",name:"guardia_id"},{required:!0,type:"number",label:"Cantidad de faltas *",name:"cantidad_faltas"},{required:!0,type:"number",step:"0.01",label:"Total de descuento *",name:"monto"},{required:!0,type:"date",label:"Fecha de inicio del periodo *",name:"fecha_inicio"},{required:!0,type:"date",label:"Fecha de fin del periodo *",name:"fecha_fin"}]},k=()=>{const{view:e,formData:a,handleInputChange:r,loadOptionsTodosGuardias:s}=_();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:$.generalFields.map(({type:i,label:d,name:n,required:l,step:p})=>t.jsx(q,{type:i,label:d,name:n,required:l,value:a[n]||"",step:p,onChange:r,loadOptions:s,disabled:e,classInput:"md:col-span-2"},n))}),t.jsx("hr",{className:"text-gray-300"}),e?t.jsx(x,{}):t.jsx(M,{})]})},T=[{key:"nombre",name:"Guardia"},{key:"fecha_inicio_format",name:"Inicio del periodo"},{key:"fecha_fin_format",name:"Fin del periodo"},{key:"cantidad_faltas",name:"Cantidad de faltas"},{key:"monto_format",name:"Monto descontado de faltas"}];function J(){const{modalType:e,currentItem:a}=_(),{data:r,isLoading:s,isError:i,error:d,handleSubmit:n,handleDelete:l}=I();return i?t.jsx("div",{children:d.message}):t.jsxs("div",{className:"md:p-4 bg-gray-100",children:[t.jsx(E,{columns:T,data:r||[],title:"Faltas",loading:s}),(e==="add"||e==="edit"||e==="view")&&t.jsx(j,{handleSubmit:n,Inputs:t.jsx(k,{})}),e==="delete"&&a&&t.jsx(v,{handleDelete:l})]})}export{J as default};
