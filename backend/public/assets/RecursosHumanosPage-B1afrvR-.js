import{u as w,t as m,j as s}from"./index-CB-Ik059.js";import{I as g,C as F,B as D,a as E}from"./CancelButtonModal-DFIIInB4.js";import{u as b,g as S,d as q,B as C}from"./BaseTable-lMESkOGa.js";import{M}from"./ModalDelete-Bkq3cXQz.js";import{a as x,u as R}from"./configAxios-zIrC1_jU.js";import{u as f,S as p}from"./sweetalert2.esm.all-nsIXK1sI.js";import{A as y}from"./AlertaCard-azZSUJ8e.js";import"./square-pen-D170uhu7.js";const $=async e=>{try{return(await x.post("recursos-humanos",e)).data}catch(a){throw console.error("Error al crear el registro",a),new Error(a.response.data.message)}},N=async()=>{try{const e=await x.get("recursos-humanos"),{data:a}=e;return Array.isArray(a)?a.map(o=>({...o,nombre_guardia:`${o.guardia.nombre} ${o.guardia.apellido_p} ${o.guardia.apellido_m}`,guardia_id:{label:`${o.guardia.nombre} ${o.guardia.apellido_p} ${o.guardia.apellido_m}`,value:o.guardia.id},sueldo_format:`$${o.sueldo}`})):[]}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},O=async e=>{try{const{id:a}=e;return(await x.put(`recursos-humanos/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},I=async e=>{try{return(await x.delete(`recursos-humanos/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},v=()=>{const e=b(r=>r.modalType),a=b(r=>r.formData),n=b(r=>r.closeModal),o=w(),{isError:l,data:i,error:t,isLoading:u}=R({queryKey:["recursos-humanos"],queryFn:N}),c=f({mutationFn:$,onSuccess:()=>{o.invalidateQueries({queryKey:["recursos-humanos"]}),m.success("Registro agregado"),n(),p.close()},onError:r=>{m.error(r.message),p.close()}}),j=f({mutationFn:O,onSuccess:()=>{o.invalidateQueries({queryKey:["recursos-humanos"]}),m.success("Registro actualizado"),n(),p.close()},onError:r=>{m.error(r.message),p.close()}}),_=f({mutationFn:I,onSuccess:()=>{o.invalidateQueries({queryKey:["recursos-humanos"]}),m.success("Registro eliminado")},onError:r=>{m.error(r.message)}});return{isLoading:u,isError:l,data:i,error:t,createMutation:c,updateMutation:j,deleteMutation:_,handleSubmit:r=>{r.preventDefault(),p.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{p.showLoading()}});const d={...a,guardia_id:a.guardia_id.value};e==="add"?c.mutate(d):e==="edit"&&j.mutate(d)},handleDelete:r=>{_.mutate(r),n()},loadOptions:async()=>{try{return(await S()).map(d=>({value:d.id,label:`${d.nombre} ${d.apellido_p} ${d.apellido_m}`}))}catch(r){return console.error("Error cargando empleados:",r),[]}}}},h={descuentosFields:[{required:!0,type:"text",label:"Descuento por faltas",name:"descuento_falta"},{required:!0,type:"text",label:"Descuento por préstamo",name:"descuento_prestamo"},{required:!0,type:"text",label:"Descuento por uniforme",name:"descuento_uniforme"},{required:!0,type:"text",label:"Otros descuentos",name:"otros_descuentos"}],sueldoFields:[{required:!0,type:"text",label:"Faltas",name:"faltas"},{required:!0,type:"text",label:"Vacaciones",name:"vacaciones"},{required:!0,type:"text",label:"Sueldo",name:"sueldo"},{required:!0,type:"text",label:"Aguinaldo",name:"aguinaldo"},{required:!0,type:"text",label:"Tiempo extra",name:"tiempo_extra"},{required:!0,type:"text",label:"Prestaciones",name:"anticipo_sueldo"},{required:!0,type:"text",label:"Días laborales",name:"dias_laborales"},{required:!0,type:"text",label:"Incapacidades",name:"incapacidades"}],otrosFields:[{required:!0,type:"text",label:"Pago IMSS",name:"pago_imss"},{required:!0,type:"text",label:"INFONAVIT",name:"infonavit"},{required:!0,type:"text",label:"Retención de impuestos",name:"retencion_impuesto"},{required:!0,type:"text",label:"FONACOT",name:"fonacot"}]},H=()=>{const{view:e,formData:a,handleInputChange:n}=q(),{loadOptions:o}=v();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[s.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:s.jsx(y,{text:"Guardia"})}),s.jsx(g,{type:"async",label:"Selecciona el guardia",name:"guardia_id",required:!0,value:a.guardia_id||"",onChange:n,loadOptions:o,classInput:"md:col-span-2",disabled:e}),s.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:s.jsx(y,{text:"Sueldos"})}),h.sueldoFields.map(({type:l,label:i,name:t,required:u})=>s.jsx(g,{type:l,label:i,name:t,required:u,value:a[t]||"",onChange:n,disabled:e},t)),s.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:s.jsx(y,{text:"Descuentos"})}),h.descuentosFields.map(({type:l,label:i,name:t,accept:u,required:c})=>s.jsx(g,{type:l,accept:u,label:i,required:c,name:t,value:a[t]||"",onChange:n,disabled:e},t)),s.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:s.jsx(y,{text:"Otros"})}),h.otrosFields.map(({type:l,label:i,name:t,accept:u,required:c})=>s.jsx(g,{type:l,accept:u,label:i,required:c,name:t,value:a[t]||"",onChange:n,disabled:e},t))]}),s.jsx("hr",{className:"text-gray-300"}),e?s.jsx(F,{}):s.jsx(D,{})]})},A=[{key:"nombre_guardia",name:"Nombre del guardia"},{key:"sueldo_format",name:"Sueldo"},{key:"dias_laborales",name:"Dias que labora"}];function U(){const{modalType:e,currentItem:a}=q(),{data:n,isLoading:o,isError:l,error:i,handleSubmit:t,handleDelete:u}=v();return l?s.jsx("div",{children:i.message}):s.jsxs("div",{className:"md:p-4 bg-gray-100",children:[s.jsx(C,{columns:A,data:n||[],title:"Recursos Humanos",loading:o}),(e==="add"||e==="edit"||e==="view")&&s.jsx(E,{handleSubmit:t,Inputs:s.jsx(H,{})}),e==="delete"&&a&&s.jsx(M,{handleDelete:u})]})}export{U as default};
