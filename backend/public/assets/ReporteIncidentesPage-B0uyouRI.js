import{r as p,j as e}from"./index-CrpPZsvu.js";import{C as f,B as x,a as b}from"./CancelButtonModal-BoD_aq40.js";import{u as m,B as y}from"./BaseTable-CsPZTHSS.js";import{u as h}from"./useQuery-JHOG_8HK.js";import{o as g,c as j,d as q}from"./firebaseConfig-enmzD80w.js";import{n as d}from"./useReportes-fRvlvEg1.js";import{A as I}from"./AlertaCard-CTxQbRQP.js";import{I as v}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const c=()=>new Promise(a=>{const s=g(j(q,"reportesIncidentes"),r=>{const n=r.docs.map(t=>({id:t.id,...t.data(),fecha:d(t.data().fecha).format("YYYY-MM-DD HH:mm:ss"),fecha_format:d(t.data().fecha).format("DD/MM/YYYY hh:mm:ss A"),guardia:`${t.data().nombre} (${t.data().numeroEmpleado})`}));a({data:n,unsubscribe:s})})}),F=()=>{var s;const a=h({queryKey:["incidentes"],queryFn:async()=>{const{data:r,unsubscribe:n}=await c();return{data:r,unsubscribe:n}},refetchOnWindowFocus:!1,staleTime:1/0,enabled:!1});return p.useEffect(()=>{let r=null;return c().then(({unsubscribe:n})=>{a.refetch(),r=n}),()=>{r&&r()}},[]),{data:((s=a.data)==null?void 0:s.data)??[],isLoading:a.isLoading,isError:a.isError,error:a.error}},N={generalFields:[{required:!1,type:"text",label:"Orden de servicio",name:"idServicio"},{required:!1,type:"text",label:"Guardia",name:"nombre"},{required:!1,type:"text",label:"No. empleado",name:"numeroEmpleado"},{required:!1,type:"datetime-local",label:"Fecha y hora de check",name:"fecha"},{required:!1,type:"text",label:"Folio de incidente",name:"folio"},{required:!1,type:"text",label:"Incidente",name:"incidente"},{required:!1,type:"text",label:"Causa del incidente",name:"causa"},{required:!1,type:"text",label:"Turno del incidente",name:"turno"},{required:!1,type:"text",label:"Persona que reporta",name:"personaReporta"},{required:!1,type:"text",label:"Punto de vigilancia",name:"puntoVigilancia"},{required:!1,type:"textarea",label:"Ubicación",name:"ubicacionIncidente"},{required:!1,type:"textarea",label:"Acciones que se tomaron",name:"accionesTomadas"},{required:!1,type:"textarea",label:"Descripción",name:"descripcion"},{required:!1,type:"textarea",label:"Recomendaciones",name:"recomendaciones"}]},E=()=>{var n,t;const{view:a,formData:s,handleInputChange:r}=m();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[N.generalFields.map(({type:i,label:o,name:l,required:u})=>e.jsx(v,{type:i,label:o,name:l,required:u,value:s[l]||"",onChange:r,disabled:a,classInput:"md:col-span-1"},l)),((n=s==null?void 0:s.fotos)==null?void 0:n.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(I,{text:"Fotos del incidente"})}),(t=s.fotos)==null?void 0:t.map((i,o)=>e.jsx("div",{className:"sm:col-span-6 md:col-span-1 w-96 mx-auto",children:e.jsx("div",{className:"border-2 rounded-lg p-4 transition-all border-blue-500 flex flex-col items-center justify-center",children:e.jsx("div",{className:"w-full",children:e.jsx("img",{src:i,alt:`Foto ${o+1} del incidente`,className:"max-h-60 mx-auto rounded-md object-contain"})})})},i+o))]})]}),e.jsx("hr",{className:"text-gray-300"}),a?e.jsx(f,{}):e.jsx(x,{})]})},Y=[{key:"servicioId",name:"Orden"},{key:"guardia",name:"Nombre"},{key:"fecha_format",name:"Fecha"},{key:"incidente",name:"Incidente"},{key:"causa",name:"Causa"},{key:"turno",name:"Turno"}];function P(){const{modalType:a}=m(),{data:s,isLoading:r,isError:n,error:t}=F();return n?e.jsx("div",{children:t.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(y,{columns:Y,data:s||[],title:"Reporte de incidentes de guardias",loading:r}),a==="view"&&e.jsx(b,{Inputs:e.jsx(E,{})})]})}export{P as default};
