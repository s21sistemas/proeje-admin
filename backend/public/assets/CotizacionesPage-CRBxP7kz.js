import{u as C,t as v,j as e}from"./index-CB-Ik059.js";import{I as i,C as F,B as N,a as z}from"./CancelButtonModal-DFIIInB4.js";import{u as q,g as E,E as O,F as M,G as T,H as D,d as I,B as k}from"./BaseTable-lMESkOGa.js";import{M as w}from"./ModalDelete-Bkq3cXQz.js";import{u as P}from"./configAxios-zIrC1_jU.js";import{u as j,S as x}from"./sweetalert2.esm.all-nsIXK1sI.js";import{A as f}from"./AlertaCard-azZSUJ8e.js";import{S as h}from"./SwitchInput-By6EEQXs.js";import"./square-pen-D170uhu7.js";const B=()=>{const t=q(s=>s.modalType),d=q(s=>s.formData),a=q(s=>s.closeModal),o=C(),{isError:u,data:p,error:c,isLoading:m}=P({queryKey:["cotizaciones"],queryFn:D}),n=j({mutationFn:T,onSuccess:()=>{o.invalidateQueries({queryKey:["cotizaciones"]}),v.success("Registro agregado"),a(),x.close()},onError:s=>{v.error(s.message),x.close()}}),l=j({mutationFn:M,onSuccess:()=>{o.invalidateQueries({queryKey:["cotizaciones"]}),v.success("Registro actualizado"),a(),x.close()},onError:s=>{v.error(s.message),x.close()}}),r=j({mutationFn:O,onSuccess:()=>{o.invalidateQueries({queryKey:["cotizaciones"]}),v.success("Registro eliminado")},onError:s=>{v.error(s.message)}});return{isLoading:m,isError:u,data:p,error:c,createMutation:n,updateMutation:l,deleteMutation:r,handleSubmit:s=>{s.preventDefault(),x.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{x.showLoading()}}),t==="add"?n.mutate(d):t==="edit"&&l.mutate(d)},handleDelete:s=>{r.mutate(s),a()},loadOptions:async()=>{try{return(await E()).map(_=>({value:_.id,label:`${_.nombre} ${_.apellido_p} ${_.apellido_m}`}))}catch(s){return console.error("Error cargando empleados:",s),[]}}}},y={generalFields:[{required:!0,type:"text",label:"Nombre del contacto *",name:"nombre_contacto"},{required:!0,type:"email",label:"Correo de contacto *",name:"correo_contacto"},{required:!0,type:"text",label:"Teléfono contacto *",name:"telefono_contacto"},{required:!0,type:"text",label:"WhatsApp contacto *",name:"whatsapp_contacto"},{required:!0,type:"text",label:"Empresa *",name:"nombre_empresa"},{required:!0,type:"text",label:"Calle *",name:"calle"},{required:!0,type:"text",label:"Número *",name:"numero"},{required:!0,type:"text",label:"Colonia *",name:"colonia"},{required:!0,type:"select",label:"Estado *",name:"estado"},{required:!0,type:"select",label:"Municipio *",name:"municipio"},{required:!0,type:"number",label:"Código postal *",name:"cp"},{required:!0,type:"text",label:"País *",name:"pais"},{required:!0,type:"text",label:"Teléfono empresa *",name:"telefono_empresa"},{required:!1,type:"text",label:"Extensión",name:"extension_empresa"},{required:!0,type:"number",label:"Días de crédito *",name:"credito_dias"}],serviciosFields:[{required:!0,type:"number",label:"Cantidad de guardias de día *",name:"guardias_dia"},{required:!0,type:"number",step:"0.01",label:"Precio total de guardias por día ($) *",name:"precio_guardias_dia"},{required:!0,type:"number",label:"Cantidad de guardias de noche *",name:"guardias_noche"},{required:!0,type:"number",step:"0.01",label:"Precio total de guardias por noche ($) *",name:"precio_guardias_noche"},{required:!0,type:"number",label:"Guardias totales *",name:"cantidad_guardias"},{required:!0,type:"select",label:"¿Ocupa jefe de grupo? *",name:"jefe_grupo",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}]},{required:!0,type:"select",label:"¿Ocupa supervisor? *",name:"supervisor",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}]},{required:!0,type:"date",label:"Fecha de servicio *",name:"fecha_servicio"}],montosFields:[{required:!0,type:"number",step:"0.01",label:"Subtotal *",name:"subtotal"},{required:!1,type:"number",step:"0.01",label:"Descuento (%)",name:"descuento_porcentaje"},{required:!1,type:"number",step:"0.01",label:"Costo extra (por algún servicio)",name:"costo_extra"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"total"}],opcSelect:[{value:"PENDIENTE",label:"Pendiente"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}],aceptadaFields:[{required:!0,type:"select",label:"Tipo de pago *",name:"tipo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"text",label:"Número de factura *",name:"numero_factura"},{required:!0,type:"date",label:"Fecha de cotización aceptada *",name:"fecha_emision"},{required:!0,type:"number",label:"Monto de la nota de credito *",step:"0.01",name:"nota_credito"}]},A=({opcionesEstados:t,formOptions:d,formData:a,loadOptionsClientes:o,handleInputChange:u,municipios:p,view:c})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(f,{text:"Información de la empresa"})}),d.generalFields.map(({type:m,label:n,name:l,required:r,step:b})=>e.jsx(i,{type:m,label:n,name:l,step:b,required:r,value:a[l]||"",loadOptions:o,onChange:g=>{u(g),l==="estado"&&u({target:{name:"municipio",value:""}})},disabled:l==="municipio"?p.length===0||a.aceptada==="SI"?!0:c:a.aceptada==="SI"?!0:c,classInput:"md:col-span-1",opcSelect:l==="estado"?t:[{value:"",label:"Selecciona un municipio"},...p]},l))]}),G=()=>{const{view:t,edit:d,formData:a,handleInputChange:o,opcionesEstados:u,municipios:p,loadOptionsClientes:c,selectOptions:m}=I();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(f,{text:"Información	de cotización aceptada"})}),e.jsx(i,{type:"select",label:"¿Cotización aceptada? *",name:"aceptada",required:!0,value:a.aceptada||"",onChange:o,disabled:t,opcSelect:y.opcSelect,classInput:"md:col-span-2"}),a.aceptada==="SI"&&y.aceptadaFields.map(({type:n,label:l,name:r,required:b,opcSelect:g,step:S})=>e.jsx(i,{type:n,label:l,name:r,step:S,required:b,opcSelect:g,value:a[r]||"",disabled:t,onChange:o,classInput:"md:col-span-1"},r))]}),e.jsx(h,{card:"Cotización para...",value:"cliente_existente",text:"¿La cotización es para un cliente?"}),a.cliente_existente?e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"async",label:"Selecciona al cliente *",name:"cliente_id",required:!0,value:a.cliente_id||"",onChange:o,loadOptions:c,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx(i,{type:"select",label:"Selecciona la sucursal *",name:"sucursal_id",required:!0,value:a.sucursal_id||"",onChange:o,opcSelect:m,disabled:m.length===0||a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),e.jsx(i,{type:"text",label:"Días de credito *",name:"credito_dias",required:!0,value:a.credito_dias||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"})]}):e.jsx(A,{opcionesEstados:u,municipios:p,loadOptionsClientes:c,formOptions:y,formData:a,handleInputChange:o,view:t}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(f,{text:"Información	general de servicios"})}),e.jsx(i,{type:"textarea",label:"Servicios *",name:"servicios",required:!0,value:a.servicios||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),y.serviciosFields.map(({type:n,label:l,name:r,required:b,step:g,opcSelect:S})=>e.jsx(i,{type:n,label:l,name:r,required:b,step:g,value:a[r]||"",opcSelect:S,onChange:o,disabled:["cantidad_guardias"].includes(r)||a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"},r)),a.jefe_grupo==="SI"&&e.jsx(i,{type:"number",label:"Costo por jefe de grupo *",name:"precio_jefe_grupo",required:!0,step:"0.01",value:a.precio_jefe_grupo||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),a.supervisor==="SI"&&e.jsx(i,{type:"number",label:"Costo por supervisor *",name:"precio_supervisor",required:!0,step:"0.01",value:a.precio_supervisor||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(f,{text:"Otra información"})}),e.jsx(i,{type:"textarea",label:"Requisitos para pago del cliente *",name:"requisitos_pago_cliente",required:!0,value:a.requisitos_pago_cliente||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx(i,{type:"select",label:"Soporte documental *",name:"soporte_documental",required:!0,opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"SI"},{value:"NO",label:"NO"}],value:a.soporte_documental||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),a.soporte_documental==="SI"&&e.jsx(i,{type:"textarea",label:"Observaciones *",name:"observaciones_soporte_documental",required:!1,value:a.observaciones_soporte_documental||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx(h,{value:"impuesto",card:"Impuesto",text:"¿Pago + IVA?"}),y.montosFields.map(({type:n,label:l,name:r,required:b,step:g})=>e.jsx(i,{type:n,label:l,name:r,required:b,step:g,value:a[r]||"",disabled:["total"].includes(r)||a.aceptada==="SI"?!0:t,onChange:o,classInput:"md:col-span-1"},r)),e.jsx(i,{type:"textarea",label:"Notas extras",name:"notas",required:!1,value:a.notas||"",onChange:o,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"})]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(F,{}):e.jsx(N,{})]})},K=[{key:"nombre_empresa",name:"Nombre empresa"},{key:"cantidad_guardias",name:"Guardias totales"},{key:"jefe_grupo",name:"Jefe de grupo"},{key:"supervisor",name:"Supervisor"},{key:"total_servicio",name:"Total servicio"},{key:"fecha_servicio_format",name:"Fecha servicio"},{key:"aceptada",name:"Acpetada"}];function X(){const{modalType:t,currentItem:d}=I(),{data:a,isLoading:o,isError:u,error:p,handleSubmit:c,handleDelete:m}=B();return u?e.jsx("div",{children:p.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(k,{columns:K,data:a||[],title:"Cotizaciones",loading:o}),(t==="add"||t==="edit"||t==="view")&&e.jsx(z,{handleSubmit:c,Inputs:e.jsx(G,{})}),t==="delete"&&d&&e.jsx(w,{handleDelete:m})]})}export{X as default};
