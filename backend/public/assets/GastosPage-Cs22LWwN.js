import{j as r,a as g,u as w,t as l}from"./index-CrpPZsvu.js";import{C as x,B as j,a as E}from"./CancelButtonModal-BoD_aq40.js";import{u as v,a as y,B as M}from"./BaseTable-CsPZTHSS.js";import{M as q}from"./ModalDelete-CfgHdyab.js";import{A as D}from"./AlertaCard-CTxQbRQP.js";import{I as C}from"./InputField-CAlv3cmG.js";import{u as S}from"./useQuery-JHOG_8HK.js";import{u as b,S as c}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as F}from"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const B={generalFields:[{required:!0,type:"async",label:"Selecciona el banco *",name:"banco_id"},{required:!0,type:"text",label:"Concepto *",name:"concepto"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]},{required:!0,type:"number",step:"0.01",label:"Subtotal *",name:"subtotal"},{required:!0,type:"number",step:"0.01",label:"Porcentaje de impuestos (si no aplica introducir 0) *",name:"impuesto"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"total"}]},T=()=>{const{view:e,formData:a,handleInputChange:s,loadOptionsBancos:t}=v();return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[r.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:r.jsx(D,{text:"Datos de gastos"})}),B.generalFields.map(({type:i,label:d,name:n,required:u,step:m,opcSelect:p})=>r.jsx(C,{type:i,label:d,name:n,step:m,required:u,value:a[n]||"",opcSelect:p,loadOptions:t,onChange:s,disabled:e,classInput:"md:col-span-1"},n))]}),r.jsx("hr",{className:"text-gray-300"}),e?r.jsx(x,{}):r.jsx(j,{})]})},_=async e=>{try{return(await g.post("gastos",e)).data}catch(a){throw console.error("Error al crear el registro",a),new Error(a.response.data.message)}},G=async()=>{try{const e=await g.get("gastos"),{data:a}=e;return Array.isArray(a)?a.map(t=>({...t,banco_id:{label:t.banco.nombre,value:t.banco.id},banco:t.banco.nombre,total_format:`$${t.total}`,fecha:F(t.created_at).format("DD/MM/YYYY")})):[]}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},k=async e=>{try{const{id:a}=e;return(await g.put(`gastos/${a}`,e)).data}catch(a){throw console.error("Error al actualizar registro:",a),new Error(a.response.data.message)}},I=async e=>{try{return(await g.delete(`gastos/${e}`)).data}catch(a){throw console.error("Error al eliminar registro:",a),new Error(a.response.data.message)}},K=()=>{const e=y(o=>o.modalType),a=y(o=>o.formData),s=y(o=>o.closeModal),t=w(),{isError:i,data:d,error:n,isLoading:u}=S({queryKey:["gastos"],queryFn:G}),m=b({mutationFn:_,onSuccess:()=>{t.invalidateQueries({queryKey:["gastos"]}),l.success("Registro agregado"),s(),c.close()},onError:o=>{l.error(o.message),c.close()}}),p=b({mutationFn:k,onSuccess:()=>{t.invalidateQueries({queryKey:["gastos"]}),l.success("Registro actualizado"),s(),c.close()},onError:o=>{l.error(o.message),c.close()}}),f=b({mutationFn:I,onSuccess:()=>{t.invalidateQueries({queryKey:["gastos"]}),l.success("Registro eliminado")},onError:o=>{l.error(o.message)}});return{isLoading:u,isError:i,data:d,error:n,createMutation:m,updateMutation:p,deleteMutation:f,handleSubmit:o=>{o.preventDefault(),c.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{c.showLoading()}});const h={...a,banco_id:a.banco_id.value};e==="add"?m.mutate(h):e==="edit"&&p.mutate(h)},handleDelete:o=>{f.mutate(o),s()}}},O=[{key:"banco",name:"Banco"},{key:"concepto",name:"Concepto"},{key:"metodo_pago",name:"Método de pago"},{key:"total_format",name:"Total"},{key:"fecha",name:"Fecha"}];function W(){const{modalType:e,currentItem:a}=v(),{data:s,isLoading:t,isError:i,error:d,handleSubmit:n,handleDelete:u}=K();return i?r.jsx("div",{children:d.message}):r.jsxs("div",{className:"md:p-4 bg-gray-100",children:[r.jsx(M,{columns:O,data:s||[],title:"Gastos",loading:t}),(e==="add"||e==="edit"||e==="view")&&r.jsx(E,{handleSubmit:n,Inputs:r.jsx(T,{})}),e==="delete"&&a&&r.jsx(q,{handleDelete:u})]})}export{W as default};
