import{a as v,u as _,t as p,j as s}from"./index-CrpPZsvu.js";import{u as E}from"./useQuery-JHOG_8HK.js";import{u as h,S as i}from"./sweetalert2.esm.all-C9US9OKy.js";import{a as b,J as w,u as x}from"./BaseTable-CsPZTHSS.js";import{n as C,g as q}from"./useReportes-fRvlvEg1.js";import{I as m}from"./InputField-CAlv3cmG.js";import{C as O,B as M}from"./CancelButtonModal-BoD_aq40.js";const j=async r=>{try{return(await v.post("almacen-entradas",r)).data}catch(e){throw console.error("Error al crear el registro",e),new Error(e.response.data.message)}},D=async()=>{try{const r=await v.get("almacen-entradas"),{data:e}=r;return e.map(a=>{var n,l;return{...a,guardia_id:{label:((n=a==null?void 0:a.guardia)==null?void 0:n.nombre)||null,value:((l=a==null?void 0:a.guardia)==null?void 0:l.id)||null},articulo_id:{label:a.articulo.nombre,value:a.articulo.id},articulo:a.articulo.nombre,numero_serie:a.numero_serie,fecha_entrada_format:C(a.fecha_entrada,"YYYY-MM-DD").format("DD/MM/YYYY")}})}catch(r){throw console.error("Error al obetener el registro",r),new Error(r.response.data.message)}},S=async r=>{try{const{id:e}=r;return(await v.put(`almacen-entradas/${e}`,r)).data}catch(e){throw console.error("Error al actualizar registro:",e),new Error(e.response.data.message)}},F=()=>{const r=b(o=>o.modalType),e=b(o=>o.formData),a=b(o=>o.closeModal),n=_(),{isError:l,data:g,error:y,isLoading:c}=E({queryKey:["entradas"],queryFn:D}),u=h({mutationFn:j,onSuccess:()=>{n.invalidateQueries({queryKey:["entradas"]}),p.success("Registro agregado"),a(),i.close()},onError:o=>{p.error(o.message),i.close()}}),d=h({mutationFn:S,onSuccess:()=>{n.invalidateQueries({queryKey:["entradas"]}),p.success("Registro actualizado"),a(),i.close()},onError:o=>{p.error(o.message),i.close()}});return{isLoading:c,isError:l,data:g,error:y,createMutation:u,updateMutation:d,handleSubmit:o=>{var f;o.preventDefault(),i.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{i.showLoading()}});const t={...e,articulo_id:e.articulo_id.value,guardia_id:((f=e.guardia_id)==null?void 0:f.value)||null};r==="add"?u.mutate(t):r==="edit"&&d.mutate(t)},loadOptionsArticulos:async()=>{try{return(await w()).map(t=>({value:t.id,label:t.nombre}))}catch(o){return console.error("Error cargando registros:",o),[]}},loadOptionsGuardias:async()=>{try{return(await q()).map(t=>({value:t.id,label:t.nombre_completo}))}catch(o){return console.error("Error cargando registros:",o),[]}}}},A={generalFields:[{required:!0,type:"async",label:"Selecciona el artículo *",name:"articulo_id"},{required:!0,type:"text",label:"Número de serie *",name:"numero_serie"},{required:!0,type:"date",label:"Fecha de entrada *",name:"fecha_entrada"},{required:!0,type:"select",label:"Tipo de entrada *",name:"tipo_entrada",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Compra",value:"Compra"},{label:"Devolución de guardia",value:"Devolución de guardia"},{label:"Cambio de equipo",value:"Cambio de equipo"},{label:"Reparación terminada",value:"Reparación terminada"},{label:"Otro",value:"Otro"}]}]},L=()=>{const{view:r,formData:e,handleInputChange:a}=x(),{loadOptionsArticulos:n,loadOptionsGuardias:l}=F();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[A.generalFields.map(({type:g,label:y,name:c,required:u,opcSelect:d})=>s.jsx(m,{type:g,label:y,name:c,required:u,value:e[c]||"",opcSelect:d,loadOptions:n,onChange:a,disabled:r,classInput:"md:col-span-1"},c)),e.tipo_entrada==="Compra"&&s.jsx(m,{type:"text",label:"# de OC *",name:"orden_compra",required:!0,value:e.orden_compra||"",onChange:a,disabled:r,classInput:"md:col-span-1"}),e.tipo_entrada==="Otro"&&s.jsx(m,{type:"text",label:"Otro concepto *",name:"otros_conceptos",required:!0,value:e.otros_conceptos||"",onChange:a,disabled:r,classInput:"md:col-span-1"}),e.tipo_entrada==="Devolución de guardia"&&s.jsx(m,{type:"async",label:"Selecciona al guardia que devuelve el equipo *",name:"guardia_id",required:!0,value:e.guardia_id||"",onChange:a,loadOptions:l,disabled:r,classInput:"md:col-span-1"})]}),s.jsx("hr",{className:"text-gray-300"}),r?s.jsx(O,{}):s.jsx(M,{})]})};export{L as F,F as u};
