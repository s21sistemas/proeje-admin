import{j as e,u as C,t as l}from"./index-CrpPZsvu.js";import{C as q,B as O,a as I}from"./CancelButtonModal-BoD_aq40.js";import{u as F,a as h,C as D,D as N,E as k,F as w,B as E}from"./BaseTable-CsPZTHSS.js";import{M}from"./ModalDelete-CfgHdyab.js";import{A as c}from"./AlertaCard-CTxQbRQP.js";import{I as u}from"./InputField-CAlv3cmG.js";import{u as z}from"./useQuery-JHOG_8HK.js";import{u as y,S as n}from"./sweetalert2.esm.all-C9US9OKy.js";import{n as _}from"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const S={generalFields:[{required:!0,type:"async",label:"Selecciona la empresa (cotización aceptada) *",name:"venta_id"},{required:!0,type:"textarea",label:"Domicilio del servicio *",name:"domicilio_servicio"},{required:!0,type:"text",label:"Código de la orden de servicio *",name:"codigo_orden_servicio"},{required:!0,type:"datetime-local",label:"Fecha de inicio del servicio *",name:"fecha_inicio"},{required:!0,type:"datetime-local",label:"Fecha del fin del servicio *",name:"fecha_fin"},{required:!0,type:"text",label:"Nombre del contacto *",name:"nombre_responsable_sitio"},{required:!0,type:"number",label:"Teléfono del contacto *",name:"telefono_responsable_sitio"},{required:!1,type:"textarea",label:"Observaciones",name:"observaciones"}],rfcFields:[{required:!1,type:"text",label:"RFC *",name:"rfc"},{required:!1,type:"text",label:"Razón social *",name:"razon_social"},{required:!1,type:"text",label:"Uso de CFDI *",name:"uso_cfdi"},{required:!1,type:"text",label:"Regimen fiscal *",name:"regimen_fiscal"}]},B=()=>{const{view:r,edit:o,formData:a,handleInputChange:i,loadOptionsVentas:m,handleCheckboxChange:p,loadOptionsGuardiasBySucursal:f,selectSupervisorBySucursal:g,selectJefeBySucursal:v,reloadGuardias:x}=F();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Estado de la orden de servicio"})}),e.jsx(u,{type:"select",label:"Selecciona el estado de la orden de servicio *",name:"estatus",required:!0,value:a.estatus||"",opcSelect:[{label:"Selecciona una opción",value:""},{label:"En proceso",value:"En proceso"},{label:"Finalizada",value:"Finalizada"},{label:"Cancelada",value:"Cancelada"}],onChange:i,disabled:r,classInput:"md:col-span-2"})]}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Información de la orden de servicio"})}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"cambiar_direccion",onChange:p,className:"sr-only peer outline-0",disabled:["Finalizada","Cancelada"].includes(a.estatus)?!0:r}),e.jsx("div",{className:"relative w-9 h-5 bg-gray-500 cursor-pointer peer-disabled:bg-gray-300 peer-disabled:cursor-auto peer-focus:outline-0 outline-0 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-gray-900",children:"¿Quiéres cambiar la dirección del servicio?"})]}),S.generalFields.map(({type:d,label:b,name:t,required:s})=>e.jsx(u,{type:d,label:b,name:t,required:s,value:a[t]||"",loadOptions:m,onChange:i,disabled:["Finalizada","Cancelada"].includes(a.estatus)?!0:t==="domicilio_servicio"?!a.cambiar_direccion:o&&t==="codigo_orden_servicio"?!0:r,classInput:"md:col-span-2"},t)),a.jefe_turno==="SI"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Asignación de jefe de turno"})}),e.jsx(u,{type:"select",label:"Jefe de turno a asignar *",name:"jefe_turno_id",required:!0,value:a.jefe_turno_id||"",onChange:i,opcSelect:v,disabled:["Finalizada","Cancelada"].includes(a.estatus)?!0:r,classInput:"md:col-span-2"})]}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Asignación de guardias"})}),e.jsx(u,{type:"async-multi",label:"Guardias a asignar *",name:"guardias_id",required:!0,value:a.guardias_id||"",onChange:i,loadOptions:f,disabled:["Finalizada","Cancelada"].includes(a.estatus)?!0:r,classInput:"md:col-span-2"},x),a.supervisor==="SI"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Asignación de supervisores"})}),e.jsx(u,{type:"select",label:"Supervisor a asignar *",name:"supervisor_id",required:!0,value:a.supervisor_id||"",onChange:i,opcSelect:g,disabled:["Finalizada","Cancelada"].includes(a.estatus)?!0:r,classInput:"md:col-span-2"})]}),(r||o)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(c,{text:"Datos fiscales informativos de la sucursal"})}),S.rfcFields.map(({type:d,label:b,name:t,required:s})=>e.jsx(u,{type:d,label:b,name:t,required:s,value:a[t]||"",onChange:i,disabled:!0,classInput:"md:col-span-1",document:a[`${t}_url`]||null},t))]})]}),e.jsx("hr",{className:"text-gray-300"}),r?e.jsx(q,{}):e.jsx(O,{})]})},R=()=>{const r=h(s=>s.modalType),o=h(s=>s.formData),a=h(s=>s.closeModal),i=C(),{isError:m,data:p,error:f,isLoading:g}=z({queryKey:["ordenes-servicios"],queryFn:w}),v=y({mutationFn:k,onSuccess:()=>{i.invalidateQueries({queryKey:["ordenes-servicios"]}),l.success("Registro agregado"),a(),n.close()},onError:s=>{l.error(s.message),n.close()}}),x=y({mutationFn:N,onSuccess:()=>{i.invalidateQueries({queryKey:["ordenes-servicios"]}),l.success("Registro actualizado"),a(),n.close()},onError:s=>{l.error(s.message),n.close()}}),d=y({mutationFn:D,onSuccess:()=>{i.invalidateQueries({queryKey:["ordenes-servicios"]}),l.success("Registro eliminado")},onError:s=>{l.error(s.message)}});return{isLoading:g,isError:m,data:p,error:f,createMutation:v,updateMutation:x,deleteMutation:d,handleSubmit:s=>{if(s.preventDefault(),n.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{n.showLoading()}}),_(o.fecha_inicio).isAfter(_(o.fecha_fin))){l.warning("La fecha de fin no puede ser antes que la fecha de inicio"),n.close();return}const j={...o,venta_id:o.venta_id.value};r==="add"?v.mutate(j):r==="edit"&&x.mutate(j)},handleDelete:s=>{d.mutate(s),a()}}},A=[{key:"codigo_orden_servicio",name:"Código"},{key:"nombre_empresa",name:"Sucursal"},{key:"domicilio_servicio",name:"Domicilio"},{key:"inicio_format",name:"Fecha inicio"},{key:"asignados",name:"Guardias"},{key:"estatus",name:"Estatus"}];function W(){const{modalType:r,currentItem:o}=F(),{data:a,isLoading:i,isError:m,error:p,handleSubmit:f,handleDelete:g}=R();return m?e.jsx("div",{children:p.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(E,{columns:A,data:a||[],title:"Ordenes de servicio",loading:i}),(r==="add"||r==="edit"||r==="view")&&e.jsx(I,{handleSubmit:f,Inputs:e.jsx(B,{})}),r==="delete"&&o&&e.jsx(M,{handleDelete:g})]})}export{W as default};
