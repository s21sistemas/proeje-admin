import{u as P,t as m,j as e}from"./index-CrpPZsvu.js";import{C as N,B as w,a as R}from"./CancelButtonModal-BoD_aq40.js";import{a as b,K as g,L as D,M as k,N as F,O as q,u as v,B as I}from"./BaseTable-CsPZTHSS.js";import{M as B}from"./ModalDelete-CfgHdyab.js";import{u as E}from"./useQuery-JHOG_8HK.js";import{u as x,S as p}from"./sweetalert2.esm.all-C9US9OKy.js";import{A as O}from"./AlertaCard-CTxQbRQP.js";import{I as j}from"./InputField-CAlv3cmG.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const K=()=>{const r=b(a=>a.modalType),i=b(a=>a.formData),l=b(a=>a.closeModal),d=g(a=>a.permisosSeleccionados),t=P(),{isLoading:c,isError:u,data:s,error:o}=E({queryKey:["roles"],queryFn:q}),n=x({mutationFn:k,onSuccess:()=>{t.invalidateQueries({queryKey:["roles"]}),m.success("Registro agregado"),p.close(),l()},onError:a=>{p.close(),m.error(a.message)}}),h=x({mutationFn:F,onSuccess:()=>{t.invalidateQueries({queryKey:["roles"]}),m.success("Registro actualizado"),l(),p.close()},onError:a=>{m.error(a.message),p.close()}}),f=x({mutationFn:D,onSuccess:()=>{t.invalidateQueries({queryKey:["roles"]}),m.success("Registro eliminado")},onError:a=>{m.error(a.message)}});return{data:s,error:o,isError:u,isLoading:c,handleSubmit:a=>{a.preventDefault(),p.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{p.showLoading()}});const S=Object.entries(d).map(([C,M])=>({modulo_id:parseInt(C),...M})),y={...i,permisos:S};r==="add"?n.mutate(y):r==="edit"&&h.mutate(y)},handleDelete:a=>{f.mutate(a),l()}}},Q={generalFields:[{required:!0,type:"text",label:"Nombre *",name:"nombre"},{required:!1,type:"textarea",label:"Descripción",name:"descripcion"}]},_=()=>{const r=g(s=>s.modulosSeleccionados),i=g(s=>s.permisosSeleccionados),l=g(s=>s.setModulosSeleccionados),d=g(s=>s.togglePermiso),t=g(s=>s.getPermisoValue);return{modulosSeleccionados:r,permisosSeleccionados:i,handleChange:s=>{l(s)},handlePermisoChange:(s,o)=>{d(s,o)},getPermisoValue:t}},$=()=>{const{view:r,formData:i,handleInputChange:l,loadOptionsModulos:d}=v(),{modulosSeleccionados:t,handleChange:c,handlePermisoChange:u,getPermisoValue:s}=_();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[Q.generalFields.map(({type:o,label:n,name:h,required:f})=>e.jsx(j,{type:o,label:n,name:h,required:f,value:i[h]||"",onChange:l,disabled:r,classInput:"md:col-span-2"},h)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(O,{text:"Permisos por módulo"})}),e.jsx(j,{type:"async-multi",label:"Selecciona el módulo *",required:!0,onChange:c,name:"modulos_id",value:t.length?t:i.modulos_id,loadOptions:d,disabled:r,classInput:"md:col-span-2"}),t.map(o=>e.jsxs("div",{className:"border border-gray-300 rounded-xl p-4 bg-gray-50 shadow",children:[e.jsxs("p",{className:"text-lg font-semibold mb-3",children:["Permisos para ",o.label]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["consultar","crear","actualizar","eliminar"].map(n=>e.jsxs("label",{className:"inline-flex items-center mt-5",children:[e.jsx("input",{type:"checkbox",name:`${o.value}_${n}`,checked:s(o.value,n),onChange:()=>u(o.value,n),className:"sr-only peer outline-0",disabled:r}),e.jsx("div",{className:"relative w-9 h-5 bg-gray-500 cursor-pointer peer-checked:peer-disabled:bg-blue-300 peer-disabled:bg-gray-300 peer-disabled:cursor-auto peer-focus:outline-0 outline-0 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-gray-900 cursor-pointer peer-disabled:cursor-auto",children:`¿Puede ${n}?`})]},`${o.value}_${n}`))})]},o.value))]}),e.jsx("hr",{className:"text-gray-300"}),r?e.jsx(N,{}):e.jsx(w,{})]})},L=[{key:"nombre",name:"Nombre"},{key:"descripcion",name:"Descripción"}];function se(){const{modalType:r,currentItem:i}=v(),{data:l,isLoading:d,isError:t,error:c,handleSubmit:u,handleDelete:s}=K();return t?e.jsx("div",{children:c.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(I,{columns:L,data:l||[],title:"Roles",loading:d}),(r==="add"||r==="edit"||r==="view")&&e.jsx(R,{handleSubmit:u,Inputs:e.jsx($,{})}),r==="delete"&&i&&e.jsx(B,{handleDelete:s})]})}export{se as default};
