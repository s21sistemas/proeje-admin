import{j as e,u as w,t as r}from"./index-CrpPZsvu.js";import{C as N,B as _,a as q}from"./CancelButtonModal-BoD_aq40.js";import{u as b,v as M,a as h,w as S,x as F,y as k,z as E,A as I,B as V}from"./BaseTable-CsPZTHSS.js";import{I as f}from"./InputField-CAlv3cmG.js";import{M as D}from"./ModalDelete-CfgHdyab.js";import{A as z}from"./AlertaCard-CTxQbRQP.js";import{u as T}from"./useQuery-JHOG_8HK.js";import{u as x,S as u}from"./sweetalert2.esm.all-C9US9OKy.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const P=({handleCancel:t})=>{const{closeModal:i,formData:s,handleInputChange:n}=b(),l=d=>{d.preventDefault(),t(s)};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",ocupacion:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-40 transition-opacity","aria-hidden":"true",onClick:i}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("form",{onSubmit:l,className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(M,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Cancelar venta"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-5",children:"¿Estás seguro de realizar esta acción? No podrás retroceder."}),e.jsx(f,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada",required:!0,value:s.motivo_cancelada||"",onChange:n,disabled:!1,classInput:"md:col-span-2"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",className:"cursor-pointer w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar venta"}),e.jsx("button",{type:"button",onClick:i,className:"cursor-pointer mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cerrar ventana"})]})]})]})})},y={generalFields:[{required:!0,type:"async",label:"Selecciona la cotizacion *",name:"cotizacion_id"},{required:!0,type:"date",label:"Fecha de cotización aceptada",name:"fecha_emision"},{required:!0,type:"select",label:"Tipo de pago *",name:"tipo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"number",step:"0.01",label:"Monto de la nota de credito *",name:"nota_credito"},{required:!0,type:"date",label:"Fecha límite de pago",name:"fecha_vencimiento"}],pagadaFields:[{required:!0,type:"text",label:"Número de factura",name:"numero_factura"},{required:!0,type:"select",label:"Método de pago *",name:"metodo_pago",opcSelect:[{label:"Selecciona una opción",value:""},{label:"Transferencia bancaria",value:"Transferencia bancaria"},{label:"Tarjeta de crédito/débito",value:"Tarjeta de crédito/débito"},{label:"Efectivo",value:"Efectivo"},{label:"Cheques",value:"Cheques"}]}]},B=()=>{const{view:t,edit:i,formData:s,handleInputChange:n,loadOptionsCotizaciones:l}=b();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[i&&e.jsx(f,{type:"select",label:"Estatus de la venta *",name:"estatus",required:!0,value:s.estatus||"",opcSelect:[{label:"Pendiente",value:"Pendiente"},{label:"Pagada",value:"Pagada"},{label:"Vencida",value:"Vencida"}],onChange:n,disabled:["Cancelada","Pagada"].includes(s.estatus)?!0:t,classInput:"md:col-span-1"}),s.estatus==="Cancelada"&&e.jsx(f,{type:"textarea",label:"Mótivo de cancelación",name:"motivo_cancelada",required:!1,value:s.motivo_cancelada||"",onChange:n,disabled:!0,classInput:"md:col-span-2"}),y.generalFields.map(({type:d,label:c,name:o,required:m,opcSelect:p,step:g})=>e.jsx(f,{type:d,label:c,name:o,required:m,value:s[o]||"",opcSelect:p,step:g,loadOptions:l,onChange:n,disabled:["Cancelada","Pagada","Vencida"].includes(s.estatus)||["fecha_vencimiento","cotizacion_id"].includes(o)?!0:t,classInput:"md:col-span-1"},o)),s.estatus==="Pagada"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(z,{text:"Información de pago"})}),y.pagadaFields.map(({type:d,label:c,name:o,required:m,opcSelect:p,step:g})=>e.jsx(f,{type:d,label:c,name:o,required:m,value:s[o]||"",opcSelect:p,step:g,loadOptions:l,onChange:n,disabled:t,classInput:"md:col-span-1"},o))]})]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(N,{}):e.jsx(_,{})]})},K=()=>{let t;const i=h(a=>a.modalType),s=h(a=>a.formData),n=h(a=>a.closeModal),l=w(),{isLoading:d,isError:c,data:o,error:m}=T({queryKey:["ventas"],queryFn:I}),p=x({mutationFn:k,onSuccess:()=>{l.invalidateQueries({queryKey:["ventas"]}),r.success("Registro agregado"),u.close(),n()},onError:a=>{u.close(),r.error(a.message)}}),g=x({mutationFn:E,onSuccess:()=>{l.invalidateQueries({queryKey:["ventas"]}),r.success("Registro actualizado"),n(),u.close()},onError:a=>{r.error(a.message),u.close()}}),j=x({mutationFn:S,onSuccess:()=>{l.invalidateQueries({queryKey:["ventas"]}),r.dismiss(t),r.warning("Venta cancelada"),n()},onError:a=>{r.dismiss(t),r.error(a.message)}}),C=x({mutationFn:F,onSuccess:()=>{l.invalidateQueries({queryKey:["ventas"]}),r.success("Registro eliminado")},onError:a=>{r.error(a.message)}});return{data:o,error:m,isError:c,isLoading:d,handleSubmit:a=>{a.preventDefault(),u.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{u.showLoading()}});const v={...s,cotizacion_id:s.cotizacion_id.value};i==="add"?p.mutate(v):i==="edit"&&g.mutate(v)},handleDelete:a=>{C.mutate(a),n()},handleCancel:a=>{t=r.loading("Cancelando venta..."),j.mutate(a)}}},O=[{key:"sucursal",name:"Sucursal"},{key:"numero_factura",name:"Número factura"},{key:"credito_dias",name:"Días de crédito"},{key:"fecha_vencimiento_format",name:"Limite de pago"},{key:"tipo_pago",name:"Tipo pago"},{key:"total",name:"Total"},{key:"estatus",name:"Estatus"}];function ae(){const{modalType:t,currentItem:i}=b(),{data:s,isLoading:n,isError:l,error:d,handleSubmit:c,handleDelete:o,handleCancel:m}=K();return l?e.jsx("div",{children:d.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(V,{columns:O,data:s||[],title:"Ventas",loading:n}),(t==="add"||t==="edit"||t==="view")&&e.jsx(q,{handleSubmit:c,Inputs:e.jsx(B,{})}),t==="delete"&&i&&e.jsx(D,{handleDelete:o}),t==="cancelar"&&i&&e.jsx(P,{handleCancel:m})]})}export{ae as default};
