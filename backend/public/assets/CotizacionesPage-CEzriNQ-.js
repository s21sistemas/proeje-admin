import{u as C,t as _,j as e}from"./index-CrpPZsvu.js";import{C as I,B as N,a as F}from"./CancelButtonModal-BoD_aq40.js";import{a as j,p as z,q as O,s as E,t as k,u as q,B as M}from"./BaseTable-CsPZTHSS.js";import{M as w}from"./ModalDelete-CfgHdyab.js";import{u as D}from"./useQuery-JHOG_8HK.js";import{u as S,S as v}from"./sweetalert2.esm.all-C9US9OKy.js";import{g as P}from"./useReportes-fRvlvEg1.js";import{A as y}from"./AlertaCard-CTxQbRQP.js";import{I as o}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";import"./circle-alert-DY7SbZfB.js";const T=()=>{const t=j(r=>r.modalType),n=j(r=>r.formData),a=j(r=>r.closeModal),s=C(),{isError:c,data:d,error:x,isLoading:m}=D({queryKey:["cotizaciones"],queryFn:k}),u=S({mutationFn:E,onSuccess:()=>{s.invalidateQueries({queryKey:["cotizaciones"]}),_.success("Registro agregado"),a(),v.close()},onError:r=>{_.error(r.message),v.close()}}),g=S({mutationFn:O,onSuccess:()=>{s.invalidateQueries({queryKey:["cotizaciones"]}),_.success("Registro actualizado"),a(),v.close()},onError:r=>{_.error(r.message),v.close()}}),l=S({mutationFn:z,onSuccess:()=>{s.invalidateQueries({queryKey:["cotizaciones"]}),_.success("Registro eliminado")},onError:r=>{_.error(r.message)}});return{isLoading:m,isError:c,data:d,error:x,createMutation:u,updateMutation:g,deleteMutation:l,handleSubmit:r=>{r.preventDefault(),v.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{v.showLoading()}});const p={...n,sucursal_empresa_id:n.sucursal_empresa_id.value};t==="add"?u.mutate(p):t==="edit"&&g.mutate(p)},handleDelete:r=>{l.mutate(r),a()},loadOptions:async()=>{try{return(await P()).map(p=>({value:p.id,label:`${p.nombre} ${p.apellido_p} ${p.apellido_m}`}))}catch(r){return console.error("Error cargando empleados:",r),[]}}}},h={generalFields:[{required:!0,type:"text",label:"Nombre del contacto *",name:"nombre_contacto"},{required:!0,type:"email",label:"Correo de contacto *",name:"correo_contacto"},{required:!0,type:"text",label:"Teléfono contacto *",name:"telefono_contacto"},{required:!0,type:"text",label:"WhatsApp contacto *",name:"whatsapp_contacto"},{required:!0,type:"text",label:"Empresa *",name:"nombre_empresa"},{required:!0,type:"text",label:"Calle *",name:"calle"},{required:!0,type:"text",label:"Número *",name:"numero"},{required:!0,type:"text",label:"Colonia *",name:"colonia"},{required:!0,type:"select",label:"Estado *",name:"estado"},{required:!0,type:"select",label:"Municipio *",name:"municipio"},{required:!0,type:"number",label:"Código postal *",name:"cp"},{required:!0,type:"text",label:"País *",name:"pais"},{required:!0,type:"text",label:"Teléfono empresa *",name:"telefono_empresa"},{required:!1,type:"text",label:"Extensión",name:"extension_empresa"},{required:!0,type:"number",label:"Días de crédito *",name:"credito_dias"}],rfcFields:[{required:!1,type:"text",label:"RFC",name:"rfc"},{required:!1,type:"text",label:"Razón social",name:"razon_social"},{required:!1,type:"text",label:"Uso de CFDI",name:"uso_cfdi"},{required:!1,type:"text",label:"Regimen fiscal",name:"regimen_fiscal"},{required:!1,type:"file",label:"Situación fiscal",name:"situacion_fiscal"}],serviciosFields:[{required:!0,type:"number",label:"Cantidad de guardias de día *",name:"guardias_dia"},{required:!0,type:"number",step:"0.01",label:"Precio unitario de guardia por día *",name:"precio_guardias_dia"},{required:!0,type:"number",step:"0.01",label:"Precio total de guardias por día *",name:"precio_guardias_dia_total"},{required:!0,type:"number",label:"Cantidad de guardias de noche *",name:"guardias_noche"},{required:!0,type:"number",step:"0.01",label:"Precio unitario de guardia por noche *",name:"precio_guardias_noche"},{required:!0,type:"number",step:"0.01",label:"Precio total de guardias por noche *",name:"precio_guardias_noche_total"},{required:!0,type:"number",label:"Guardias totales *",name:"cantidad_guardias"},{required:!0,type:"select",label:"¿Ocupa jefe de turno? *",name:"jefe_turno",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}]},{required:!0,type:"select",label:"¿Ocupa supervisor? *",name:"supervisor",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}]},{required:!0,type:"date",label:"Fecha de servicio *",name:"fecha_servicio"}],montosFields:[{required:!0,type:"number",step:"0.01",label:"Subtotal *",name:"subtotal"},{required:!1,type:"number",step:"0.01",label:"Descuento (%)",name:"descuento_porcentaje"},{required:!1,type:"number",step:"0.01",label:"Costo extra (por algún servicio)",name:"costo_extra"},{required:!0,type:"number",step:"0.01",label:"Total *",name:"total"}],opcSelect:[{value:"PENDIENTE",label:"Pendiente"},{value:"SI",label:"Sí"},{value:"NO",label:"No"}],aceptadaFields:[{required:!0,type:"date",label:"Fecha de cotización aceptada *",name:"fecha_emision"},{required:!0,type:"select",label:"Tipo de pago *",name:"tipo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Crédito",label:"Crédito"},{value:"Contado",label:"Contado"}]},{required:!0,type:"number",label:"Monto de la nota de credito *",step:"0.01",name:"nota_credito"}]},R=({opcionesEstados:t,formOptions:n,formData:a,loadOptionsClientes:s,handleInputChange:c,handleFileChange:d,municipios:x,view:m})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Información de la empresa"})}),n.generalFields.map(({type:u,label:g,name:l,required:b,step:i})=>e.jsx(o,{type:u,label:g,name:l,step:i,required:b,value:a[l]||"",loadOptions:s,onChange:f=>{c(f),l==="estado"&&c({target:{name:"municipio",value:""}})},disabled:l==="municipio"?x.length===0||a.aceptada==="SI"?!0:m:a.aceptada==="SI"?!0:m,classInput:"md:col-span-1",opcSelect:l==="estado"?t:[{value:"",label:"Selecciona un municipio"},...x]},l)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Datos fiscales"})}),n.rfcFields.map(({type:u,label:g,name:l,required:b})=>e.jsx(o,{type:u,label:g,name:l,required:u==="file"?!1:b,value:a[l]||"",onChange:u==="file"?d:c,disabled:a.aceptada==="SI"?!0:m,classInput:"md:col-span-1",document:a[`${l}_url`]||null},l))]}),B=({value:t,card:n,text:a})=>{const{view:s,handleCheckboxChange:c,formData:d}=q();return e.jsxs("div",{className:"sm:col-span-6 md:col-span-2",children:[e.jsx(y,{text:n}),e.jsxs("label",{className:"inline-flex items-center mt-5",children:[e.jsx("input",{type:"checkbox",name:t,checked:d[t]||!1,onChange:c,className:"sr-only peer outline-0",disabled:["Pagada","Cancelada"].includes(d.estatus)||d.aceptada==="SI"?!0:s}),e.jsx("div",{className:"relative w-9 h-5 bg-gray-500 cursor-pointer peer-disabled:bg-gray-300 peer-disabled:cursor-auto peer-focus:outline-0 outline-0 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-gray-900",children:a})]})]})},K=()=>{const{view:t,edit:n,formData:a,handleInputChange:s,handleFileChange:c,opcionesEstados:d,municipios:x,loadOptionsClientes:m,selectOptions:u,loadOptionsSucursalesEmpresa:g}=q();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Información	de cotización aceptada"})}),e.jsx(o,{type:"select",label:"¿Cotización aceptada? *",name:"aceptada",required:!0,value:a.aceptada||"",onChange:s,disabled:t,opcSelect:h.opcSelect,classInput:"md:col-span-2"}),a.aceptada==="SI"&&h.aceptadaFields.map(({type:l,label:b,name:i,required:f,opcSelect:r,step:p})=>e.jsx(o,{type:l,label:b,name:i,step:p,required:f,opcSelect:r,value:a[i]||"",disabled:t,onChange:s,classInput:"md:col-span-1"},i))]}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Sucursal de la empresa donde se hará la cotización"})}),e.jsx(o,{type:"async",label:"Selecciona la sucursal *",name:"sucursal_empresa_id",required:!0,value:a.sucursal_empresa_id||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,loadOptions:g,classInput:"md:col-span-2"}),e.jsx(B,{card:"Cotización para...",value:"cliente_existente",text:"¿La cotización es para un cliente?"}),a.cliente_existente?e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"async",label:"Selecciona al cliente *",name:"cliente_id",required:!0,value:a.cliente_id||"",onChange:s,loadOptions:m,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx(o,{type:"select",label:"Selecciona la sucursal *",name:"sucursal_id",required:!0,value:a.sucursal_id||"",onChange:s,opcSelect:u,disabled:u.length===0||a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),e.jsx(o,{type:"text",label:"Días de credito *",name:"credito_dias",required:!0,value:a.credito_dias||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"})]}):e.jsx(R,{opcionesEstados:d,municipios:x,loadOptionsClientes:m,formOptions:h,formData:a,handleInputChange:s,handleFileChange:c,view:t}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Información	general de servicios"})}),e.jsx(o,{type:"textarea",label:"Servicios *",name:"servicios",required:!0,value:a.servicios||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),h.serviciosFields.map(({type:l,label:b,name:i,required:f,step:r,opcSelect:p})=>e.jsx(o,{type:l,label:b,name:i,required:f,step:r,value:a[i]||"",opcSelect:p,onChange:s,disabled:["cantidad_guardias","precio_guardias_dia_total","precio_guardias_noche_total"].includes(i)||a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"},i)),a.jefe_turno==="SI"&&e.jsx(o,{type:"number",label:"Costo por jefe de turno *",name:"precio_jefe_turno",required:!0,step:"0.01",value:a.precio_jefe_turno||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),a.supervisor==="SI"&&e.jsx(o,{type:"number",label:"Costo por supervisor *",name:"precio_supervisor",required:!0,step:"0.01",value:a.precio_supervisor||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-1"}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Otra información"})}),e.jsx(o,{type:"textarea",label:"Requisitos para pago del cliente",name:"requisitos_pago_cliente",required:!1,value:a.requisitos_pago_cliente||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx(o,{type:"select",label:"Soporte documental *",name:"soporte_documental",required:!0,opcSelect:[{value:"",label:"Selecciona una opción"},{value:"SI",label:"SI"},{value:"NO",label:"NO"}],value:a.soporte_documental||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),a.soporte_documental==="SI"&&e.jsx(o,{type:"textarea",label:"Observaciones *",name:"observaciones_soporte_documental",required:!1,value:a.observaciones_soporte_documental||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Total"})}),e.jsx(o,{type:"number",step:"0.01",label:"Porcentaje de impuestos (si no aplica introducir 0) *",name:"impuesto",required:!0,value:a.impuesto||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"}),h.montosFields.map(({type:l,label:b,name:i,required:f,step:r})=>e.jsx(o,{type:l,label:b,name:i,required:f,step:r,value:a[i]||"",disabled:["total"].includes(i)||a.aceptada==="SI"?!0:t,onChange:s,classInput:"md:col-span-1"},i)),e.jsx(o,{type:"textarea",label:"Notas extras",name:"notas",required:!1,value:a.notas||"",onChange:s,disabled:a.aceptada==="SI"?!0:t,classInput:"md:col-span-2"})]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(I,{}):e.jsx(N,{})]})},Q=[{key:"nombre_empresa",name:"Nombre empresa"},{key:"cantidad_guardias",name:"Guardias totales"},{key:"jefe_turno",name:"Jefe de turno"},{key:"supervisor",name:"Supervisor"},{key:"total_servicio",name:"Total servicio"},{key:"fecha_servicio_format",name:"Fecha servicio"},{key:"aceptada",name:"Acpetada"}];function Z(){const{modalType:t,currentItem:n}=q(),{data:a,isLoading:s,isError:c,error:d,handleSubmit:x,handleDelete:m}=T();return c?e.jsx("div",{children:d.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(M,{columns:Q,data:a||[],title:"Cotizaciones",loading:s}),(t==="add"||t==="edit"||t==="view")&&e.jsx(F,{handleSubmit:x,Inputs:e.jsx(K,{})}),t==="delete"&&n&&e.jsx(w,{handleDelete:m})]})}export{Z as default};
