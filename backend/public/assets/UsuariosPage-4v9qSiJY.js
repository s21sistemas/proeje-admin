import{a as p,u as j,t as l,j as a}from"./index-CrpPZsvu.js";import{C as v,B as C,a as E}from"./CancelButtonModal-BoD_aq40.js";import{a as y,u as w,B as M}from"./BaseTable-CsPZTHSS.js";import{M as q}from"./ModalDelete-CfgHdyab.js";import{u as F}from"./useQuery-JHOG_8HK.js";import{u as h,S as i}from"./sweetalert2.esm.all-C9US9OKy.js";import{I as b}from"./InputField-CAlv3cmG.js";import"./useReportes-fRvlvEg1.js";import"./eye-DTpaqRd9.js";const k=async e=>{try{return(await p.post("usuarios",e)).data}catch(r){throw console.error("Error al agregar registro:",r),new Error(r.response.data.message)}},_=async()=>{try{const e=await p.get("usuarios"),{data:r}=e;return r.map(o=>({...o,rol_id:{label:o.rol.nombre,value:o.rol.id},rol_asignado:o.rol.nombre}))}catch(e){throw console.error("Error al obetener el registro",e),new Error(e.response.data.message)}},D=async e=>{try{const{id:r}=e;return(await p.put(`usuarios/${r}`,e)).data}catch(r){throw console.error("Error al actualizar registro:",r),new Error(r.response.data.message)}},N=async e=>{try{return(await p.delete(`usuarios/${e}`)).data}catch(r){throw console.error("Error al eliminar registro:",r),new Error(r.response.data.message)}},S=()=>{const e=y(s=>s.modalType),r=y(s=>s.formData),o=y(s=>s.closeModal),t=j(),{isLoading:n,isError:d,data:u,error:c}=F({queryKey:["usuarios"],queryFn:_}),g=h({mutationFn:k,onSuccess:()=>{t.invalidateQueries({queryKey:["usuarios"]}),l.success("Registro agregado"),i.close(),o()},onError:s=>{i.close(),l.error(s.message)}}),m=h({mutationFn:D,onSuccess:()=>{t.invalidateQueries({queryKey:["usuarios"]}),l.success("Registro actualizado"),o(),i.close()},onError:s=>{l.error(s.message),i.close()}}),f=h({mutationFn:N,onSuccess:()=>{t.invalidateQueries({queryKey:["usuarios"]}),l.success("Registro eliminado")},onError:s=>{l.error(s.message)}});return{data:u,error:c,isError:d,isLoading:n,handleSubmit:s=>{s.preventDefault(),i.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{i.showLoading()}});const x={...r,rol_id:r.rol_id.value};e==="add"?g.mutate(x):e==="edit"&&m.mutate(x)},handleDelete:s=>{f.mutate(s),o()}}},I={generalFields:[{required:!0,type:"text",label:"Nombre",name:"nombre_completo"},{required:!0,type:"async",label:"Rol",name:"rol_id"},{required:!0,type:"email",label:"Correo",name:"email"}]},U=()=>{const{view:e,add:r,edit:o,formData:t,handleInputChange:n,loadOptionsRoles:d,handleCheckboxChange:u}=w();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[I.generalFields.map(({type:c,label:g,name:m,required:f})=>a.jsx(b,{type:c,label:g,name:m,required:f,value:t[m]||"",onChange:n,disabled:e,loadOptions:d,classInput:"md:col-span-2"},m)),r&&a.jsx(b,{type:"password",label:"Contraseña",name:"password",required:!0,value:t.password||"",onChange:n,disabled:e,classInput:"md:col-span-2"}),o&&a.jsxs(a.Fragment,{children:[a.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",name:"cambiar_pass",onChange:u,className:"sr-only peer outline-0",disabled:e}),a.jsx("div",{className:"relative w-9 h-5 bg-gray-500 cursor-pointer peer-disabled:bg-gray-300 peer-disabled:cursor-auto peer-focus:outline-0 outline-0 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"}),a.jsx("span",{className:"ms-3 text-sm font-medium text-gray-900",children:"Cambiar contraseña"})]}),t.cambiar_pass&&a.jsx(b,{type:"password",label:"Contraseña",name:"password",required:!0,value:t.password||"",onChange:n,disabled:e,classInput:"md:col-span-2"})]})]}),a.jsx("hr",{className:"text-gray-300"}),e?a.jsx(v,{}):a.jsx(C,{})]})},B=[{key:"nombre_completo",name:"Nombre completo"},{key:"email",name:"Correo"},{key:"rol_asignado",name:"Rol"}];function H(){const{modalType:e,currentItem:r}=w(),{data:o,isLoading:t,isError:n,error:d,handleSubmit:u,handleDelete:c}=S();return n?a.jsx("div",{children:d.message}):a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(M,{columns:B,data:o||[],title:"Usuarios",loading:t}),(e==="add"||e==="edit"||e==="view")&&a.jsx(E,{handleSubmit:u,Inputs:a.jsx(U,{})}),e==="delete"&&r&&a.jsx(q,{handleDelete:c})]})}export{H as default};
