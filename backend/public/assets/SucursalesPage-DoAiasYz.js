import{j as e,u as S,t as d}from"./index-CB-Ik059.js";import{I as f,C,B as F,a as _}from"./CancelButtonModal-DFIIInB4.js";import{d as v,u as b,p as D,q as M,s as E,t as N,B as I}from"./BaseTable-lMESkOGa.js";import{M as R}from"./ModalDelete-Bkq3cXQz.js";import{A as y}from"./AlertaCard-azZSUJ8e.js";import{u as w}from"./configAxios-zIrC1_jU.js";import{u as h,S as m}from"./sweetalert2.esm.all-nsIXK1sI.js";import"./square-pen-D170uhu7.js";const g={generalFields:[{required:!0,type:"async",label:"Selecciona al cliente *",name:"cliente_id"}],contactoFields:[{required:!0,type:"text",label:"Nombre *",name:"nombre_contacto"},{required:!0,type:"text",label:"Teléfono *",name:"telefono_contacto"},{required:!0,type:"text",label:"WhatsApp *",name:"whatsapp_contacto"},{required:!0,type:"email",label:"Correo *",name:"correo_contacto"}],empresaFields:[{required:!0,type:"text",label:"Nombre de la sucursal *",name:"nombre_empresa"},{required:!0,type:"text",label:"Calle *",name:"calle"},{required:!0,type:"text",label:"Número *",name:"numero"},{required:!0,type:"text",label:"Colonia *",name:"colonia"},{required:!0,type:"select",label:"Estado *",name:"estado"},{required:!0,type:"select",label:"Municipio *",name:"municipio"},{required:!0,type:"number",label:"Código postal *",name:"cp"},{required:!0,type:"text",label:"País *",name:"pais"},{required:!0,type:"text",label:"Teléfono sucursal *",name:"telefono_empresa"},{required:!1,type:"text",label:"Extensión",name:"extension_empresa"}],rfcFields:[{required:!0,type:"text",label:"RFC *",name:"rfc"},{required:!0,type:"text",label:"Razón social *",name:"razon_social"},{required:!0,type:"text",label:"Uso de CFDI *",name:"uso_cfdi"},{required:!0,type:"text",label:"Regimen fiscal *",name:"regimen_fiscal"},{required:!0,type:"file",label:"Situación fiscal *",name:"situacion_fiscal"}]},k=()=>{const{view:t,formData:o,handleInputChange:l,opcionesEstados:c,municipios:u,loadOptionsClientes:p,handleFileChange:x}=v();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Empresa perteneciente"})}),g.generalFields.map(({type:r,label:n,name:a,required:i})=>e.jsx(f,{type:r,label:n,name:a,required:i,value:o[a]||"",loadOptions:p,onChange:l,disabled:t,classInput:"md:col-span-2"},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Datos del contacto"})}),g.contactoFields.map(({type:r,label:n,name:a,required:i})=>e.jsx(f,{type:r,label:n,name:a,required:i,value:o[a]||"",onChange:l,disabled:t,classInput:"md:col-span-1"},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Datos de la sucursal"})}),g.empresaFields.map(({type:r,label:n,name:a,required:i})=>e.jsx(f,{type:r,label:n,name:a,required:i,value:o[a]||"",onChange:q=>{l(q),a==="estado"&&l({target:{name:"municipio",value:""}})},disabled:a==="municipio"&&u.length===0?!0:t,opcSelect:a==="estado"?c:[{value:"",label:"Selecciona un municipio"},...u],classInput:"md:col-span-1"},a)),e.jsx("div",{className:"sm:col-span-6 md:col-span-2",children:e.jsx(y,{text:"Datos fiscales"})}),g.rfcFields.map(({type:r,label:n,name:a,required:i})=>e.jsx(f,{type:r,label:n,name:a,required:r==="file"?!1:i,value:o[a]||"",onChange:r==="file"?x:l,disabled:t,classInput:"md:col-span-1",document:o[`${a}_url`]||null},a))]}),e.jsx("hr",{className:"text-gray-300"}),t?e.jsx(C,{}):e.jsx(F,{})]})},B=()=>{const t=b(s=>s.modalType),o=b(s=>s.formData),l=b(s=>s.closeModal),c=S(),{isError:u,data:p,error:x,isLoading:r}=w({queryKey:["sucursales"],queryFn:N}),n=h({mutationFn:E,onSuccess:()=>{c.invalidateQueries({queryKey:["sucursales"]}),d.success("Registro agregado"),l(),m.close()},onError:s=>{d.error(s.message),m.close()}}),a=h({mutationFn:M,onSuccess:()=>{c.invalidateQueries({queryKey:["sucursales"]}),d.success("Registro actualizado"),l(),m.close()},onError:s=>{d.error(s.message),m.close()}}),i=h({mutationFn:D,onSuccess:()=>{c.invalidateQueries({queryKey:["sucursales"]}),d.success("Registro eliminado")},onError:s=>{d.error(s.message)}});return{isLoading:r,isError:u,data:p,error:x,createMutation:n,updateMutation:a,deleteMutation:i,handleSubmit:s=>{s.preventDefault(),m.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{m.showLoading()}});const j={...o,cliente_id:o.cliente_id.value};t==="add"?n.mutate(j):t==="edit"&&a.mutate(j)},handleDelete:s=>{i.mutate(s),l()}}},T=[{key:"empresa",name:"Empresa"},{key:"nombre_empresa",name:"Sucursal"},{key:"rfc",name:"RFC"},{key:"razon_social",name:"Razón social"},{key:"nombre_contacto",name:"Nombre contacto"},{key:"telefono_contacto",name:"Teléfono contacto"}];function W(){const{modalType:t,currentItem:o}=v(),{data:l,isLoading:c,isError:u,error:p,handleSubmit:x,handleDelete:r}=B();return u?e.jsx("div",{children:p.message}):e.jsxs("div",{className:"md:p-4 bg-gray-100",children:[e.jsx(I,{columns:T,data:l||[],title:"Sucursales de clientes",loading:c}),(t==="add"||t==="edit"||t==="view")&&e.jsx(_,{handleSubmit:x,Inputs:e.jsx(k,{})}),t==="delete"&&o&&e.jsx(R,{handleDelete:r})]})}export{W as default};
