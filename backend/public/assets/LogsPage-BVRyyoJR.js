import{a as c,j as a}from"./index-CrpPZsvu.js";import{C as p,B as b,a as y}from"./CancelButtonModal-BoD_aq40.js";import{u as m,B as g}from"./BaseTable-CsPZTHSS.js";import{u as x}from"./useQuery-JHOG_8HK.js";import{n as d}from"./useReportes-fRvlvEg1.js";import{I as u}from"./InputField-CAlv3cmG.js";import"./eye-DTpaqRd9.js";const f=async()=>{try{const r=await c.get("logs"),{data:o}=r;return o.map(e=>{const n=e.datos_anteriores?JSON.stringify(e.datos_anteriores,null,3):"",s=e.datos_nuevos?JSON.stringify(e.datos_nuevos,null,3):"";return{...e,fecha:d(e.created_at).format("YYYY-MM-DD HH:mm:ss"),fecha_cambio:d(e.created_at).format("DD/MM/YYYY"),datos_anteriores:n,nombre_usuario:e.usuario.nombre_completo,datos_nuevos:s}})}catch(r){throw console.error("Error al obetener el registro",r),new Error(r.response.data.message)}},h=()=>{const{isLoading:r,isError:o,data:t,error:e}=x({queryKey:["logs"],queryFn:f});return{data:t,error:e,isError:o,isLoading:r}},l={generalFields:[{required:!0,type:"number",label:"ID del módulo que cambió",name:"modulo_id"},{required:!0,type:"text",label:"Módulo en el que se hizo el cambió",name:"modulo"},{required:!0,type:"text",label:"Acción realizada",name:"accion"},{required:!0,type:"text",label:"Usuario que hizo el cambió",name:"nombre_usuario"},{required:!0,type:"text",label:"IP de quien hizo el cambió",name:"ip"},{required:!0,type:"datetime-local",label:"Fecha del cambió",name:"fecha"}],datosFields:[{required:!0,type:"textarea",label:"Datos anteriores (si es nuevo registro se mostrará vacío)",name:"datos_anteriores"},{required:!0,type:"textarea",label:"Datos nuevos",name:"datos_nuevos"}]},_=()=>{const{view:r,formData:o,handleInputChange:t}=m();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[l.generalFields.map(({type:e,label:n,name:s,required:i})=>a.jsx(u,{type:e,label:n,name:s,required:i,value:o[s]||"",onChange:t,disabled:r,classInput:"md:col-span-1"},s)),l.datosFields.map(({type:e,label:n,name:s,required:i})=>a.jsx(u,{type:e,label:n,name:s,required:i,value:o[s]||"",onChange:t,disabled:r,classInput:"md:col-span-2"},s))]}),a.jsx("hr",{className:"text-gray-300"}),r?a.jsx(p,{}):a.jsx(b,{})]})},j=[{key:"modulo_id",name:"ID Módulo"},{key:"modulo",name:"Módulo que cambió"},{key:"accion",name:"Acción"},{key:"nombre_usuario",name:"Usuario"},{key:"fecha_cambio",name:"Fecha de cambio"},{key:"ip",name:"IP"}];function k(){const{modalType:r}=m(),{data:o,isLoading:t,isError:e,error:n}=h();return e?a.jsx("div",{children:n.message}):a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(g,{columns:j,data:o||[],title:"Movimientos del sistema",loading:t}),r==="view"&&a.jsx(y,{Inputs:a.jsx(_,{})})]})}export{k as default};
